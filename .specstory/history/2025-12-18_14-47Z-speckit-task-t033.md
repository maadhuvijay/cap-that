<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session d61279fe-752d-4951-935a-b39ad45acc11 (2025-12-18 14:47Z) -->

# Speckit task T033 (2025-12-18 14:47Z)

_**User (2025-12-18 11:25Z)**_

/speckit.tasks T033

--- Cursor Command: speckit.tasks.md ---
---
description: Generate an actionable, dependency-ordered tasks.md for the feature based on available design artifacts.
handoffs: 
  - label: Analyze For Consistency
    agent: speckit.analyze
    prompt: Run a project analysis for consistency
    send: true
  - label: Implement Project
    agent: speckit.implement
    prompt: Start the implementation in phases
    send: true
---

## User Input

```text
T033
```

You **MUST** consider the user input before proceeding (if not empty).

## Outline

1. **Setup**: Run `.specify/scripts/bash/check-prerequisites.sh --json` from repo root and parse FEATURE_DIR and AVAILABLE_DOCS list. All paths must be absolute. For single quotes in args like "I'm Groot", use escape syntax: e.g 'I'\''m Groot' (or double-quote if possible: "I'm Groot").

2. **Load design documents**: Read from FEATURE_DIR:
   - **Required**: plan.md (tech stack, libraries, structure), spec.md (user stories with priorities)
   - **Optional**: data-model.md (entities), contracts/ (API endpoints), research.md (decisions), quickstart.md (test scenarios)
   - Note: Not all projects have all documents. Generate tasks based on what's available.

3. **Execute task generation workflow**:
   - Load plan.md and extract tech stack, libraries, project structure
   - Load spec.md and extract user stories with their priorities (P1, P2, P3, etc.)
   - If data-model.md exists: Extract entities and map to user stories
   - If contracts/ exists: Map endpoints to user stories
   - If research.md exists: Extract decisions for setup tasks
   - Generate tasks organized by user story (see Task Generation Rules below)
   - Generate dependency graph showing user story completion order
   - Create parallel execution examples per user story
   - Validate task completeness (each user story has all needed tasks, independently testable)

4. **Generate tasks.md**: Use `.specify/templates/tasks-template.md` as structure, fill with:
   - Correct feature name from plan.md
   - Phase 1: Setup tasks (project initialization)
   - Phase 2: Foundational tasks (blocking prerequisites for all user stories)
   - Phase 3+: One phase per user story (in priority order from spec.md)
   - Each phase includes: story goal, independent test criteria, tests (if requested), implementation tasks
   - Final Phase: Polish & cross-cutting concerns
   - All tasks must follow the strict checklist format (see Task Generation Rules below)
   - Clear file paths for each task
   - Dependencies section showing story completion order
   - Parallel execution examples per story
   - Implementation strategy section (MVP first, incremental delivery)

5. **Report**: Output path to generated tasks.md and summary:
   - Total task count
   - Task count per user story
   - Parallel opportunities identified
   - Independent test criteria for each story
   - Suggested MVP scope (typically just User Story 1)
   - Format validation: Confirm ALL tasks follow the checklist format (checkbox, ID, labels, file paths)

Context for task generation: T033

The tasks.md should be immediately executable - each task must be specific enough that an LLM can complete it without additional context.

## Task Generation Rules

**CRITICAL**: Tasks MUST be organized by user story to enable independent implementation and testing.

**Tests are OPTIONAL**: Only generate test tasks if explicitly requested in the feature specification or if user requests TDD approach.

### Checklist Format (REQUIRED)

Every task MUST strictly follow this format:

```text
- [ ] [TaskID] [P?] [Story?] Description with file path
```

**Format Components**:

1. **Checkbox**: ALWAYS start with `- [ ]` (markdown checkbox)
2. **Task ID**: Sequential number (T001, T002, T003...) in execution order
3. **[P] marker**: Include ONLY if task is parallelizable (different files, no dependencies on incomplete tasks)
4. **[Story] label**: REQUIRED for user story phase tasks only
   - Format: [US1], [US2], [US3], etc. (maps to user stories from spec.md)
   - Setup phase: NO story label
   - Foundational phase: NO story label  
   - User Story phases: MUST have story label
   - Polish phase: NO story label
5. **Description**: Clear action with exact file path

**Examples**:

- ‚úÖ CORRECT: `- [ ] T001 Create project structure per implementation plan`
- ‚úÖ CORRECT: `- [ ] T005 [P] Implement authentication middleware in src/middleware/auth.py`
- ‚úÖ CORRECT: `- [ ] T012 [P] [US1] Create User model in src/models/user.py`
- ‚úÖ CORRECT: `- [ ] T014 [US1] Implement UserService in src/services/user_service.py`
- ‚ùå WRONG: `- [ ] Create User model` (missing ID and Story label)
- ‚ùå WRONG: `T001 [US1] Create model` (missing checkbox)
- ‚ùå WRONG: `- [ ] [US1] Create User model` (missing Task ID)
- ‚ùå WRONG: `- [ ] T001 [US1] Create model` (missing file path)

### Task Organization

1. **From User Stories (spec.md)** - PRIMARY ORGANIZATION:
   - Each user story (P1, P2, P3...) gets its own phase
   - Map all related components to their story:
     - Models needed for that story
     - Services needed for that story
     - Endpoints/UI needed for that story
     - If tests requested: Tests specific to that story
   - Mark story dependencies (most stories should be independent)

2. **From Contracts**:
   - Map each contract/endpoint ‚Üí to the user story it serves
   - If tests requested: Each contract ‚Üí contract test task [P] before implementation in that story's phase

3. **From Data Model**:
   - Map each entity to the user story(ies) that need it
   - If entity serves multiple stories: Put in earliest story or Setup phase
   - Relationships ‚Üí service layer tasks in appropriate story phase

4. **From Setup/Infrastructure**:
   - Shared infrastructure ‚Üí Setup phase (Phase 1)
   - Foundational/blocking tasks ‚Üí Foundational phase (Phase 2)
   - Story-specific setup ‚Üí within that story's phase

### Phase Structure

- **Phase 1**: Setup (project initialization)
- **Phase 2**: Foundational (blocking prerequisites - MUST complete before user stories)
- **Phase 3+**: User Stories in priority order (P1, P2, P3...)
  - Within each story: Tests (if requested) ‚Üí Models ‚Üí Services ‚Üí Endpoints ‚Üí Integration
  - Each phase should be a complete, independently testable increment
- **Final Phase**: Polish & Cross-Cutting Concerns

--- End Command ---

---

_**Agent (model default, mode Agent)**_



---


Checking prerequisites and loading design documents for T033.


---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **run_terminal_cmd** ‚Ä¢ Run command: cd c:\dev\capthat\cap-that && bash .specify/scripts/bash/check-prerequisites.sh --json</summary>

```bash
cd c:\dev\capthat\cap-that && bash .specify/scripts/bash/check-prerequisites.sh --json
```

```
At C:\Users\maadh\AppData\Local\Temp\ps-script-f51d5315-9ad7-49af-8283-ab583f130221.ps1:7 char:28
+ cd c:\dev\capthat\cap-that &amp;&amp; bash .specify/scripts/bash/check-prereq ...
+                            ~~
The token '&amp;&amp;' is not a valid statement separator in this version.
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
    + FullyQualifiedErrorId : InvalidEndOfLine
 

```
</details>
</tool-use>

---



---





---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **run_terminal_cmd** ‚Ä¢ Run command: cd c:\dev\capthat\cap-that; bash .specify/scripts/bash/check-prerequisites.sh --json</summary>

```bash
cd c:\dev\capthat\cap-that; bash .specify/scripts/bash/check-prerequisites.sh --json
```

```
bash : The term 'bash' is not recognized as the name of a cmdlet, function, script file, or operable program. Check 
the spelling of the name, or if a path was included, verify that the path is correct and try again.
At C:\Users\maadh\AppData\Local\Temp\ps-script-b82e78d3-0589-4931-93b8-dc8f77d3c501.ps1:7 char:29
+ cd c:\dev\capthat\cap-that; bash .specify/scripts/bash/check-prerequi ...
+                             ~~~~
    + CategoryInfo          : ObjectNotFound: (bash:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
 

```
</details>
</tool-use>

---



---


Checking the script and locating T033:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: .specify/scripts/bash/check-prerequisites.sh</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** ‚Ä¢ Searched codebase "**/T033/**" ‚Ä¢ **0** result in **1** directory</summary>

Directory: **c:\dev\capthat\cap-that** (0 file)

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** ‚Ä¢ Searched codebase "**/033/**" ‚Ä¢ **0** result in **1** directory</summary>

Directory: **c:\dev\capthat\cap-that** (0 file)

</details>
</tool-use>

---



---


Checking the specs directory structure and locating T033:


---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: .specify/scripts/bash/common.sh</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** ‚Ä¢ Searched codebase "T033 feature directory structure" ‚Ä¢ **15** results</summary>
            
| File | Lines |
|------|-------|
| `.specify/templates/plan-template.md` | L43-107 |
| `.specify/templates/plan-template.md` | L47 |
| `.specify/templates/tasks-template.md` | L51-107 |
| `.specify/templates/tasks-template.md` | L56 |
| `.specify/scripts/bash/common.sh` | L61-120 |
| `.specify/scripts/bash/common.sh` | L116-156 |
| `.cursor/commands/speckit.tasks.md` | L42 |
| `.specify/scripts/bash/common.sh` | L68 |
| `.specify/templates/tasks-template.md` | L103-166 |
| `.specify/scripts/bash/check-prerequisites.sh` | L54-116 |
| `.specify/scripts/bash/setup-plan.sh` | L61 |
| `.specify/scripts/bash/create-new-feature.sh` | L224-282 |
| `.specify/templates/spec-template.md` | L62 |
| `.cursor/commands/speckit.tasks.md` | L122-137 |
| `.cursor/commands/speckit.tasks.md` | L40-85 |

</details>
</tool-use>

---



---


Checking the existing tasks.md and locating the T033 reference:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: specs/001-capthat-extension/tasks.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "T033" in "specs" ‚Ä¢ 1 match</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `specs\001-capthat-extension\tasks.md` | `- [ ] T033 [US1] Test extension reload functionality (make code change, rebuild, reload extension, verify changes appear)` | L109 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: .specify/templates/tasks-template.md</summary>

</details>
</tool-use>

---



---


T033 is a task ID in the existing tasks.md. Regenerating tasks.md from the design documents. Loading the design documents:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: specs/001-capthat-extension/plan.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: specs/001-capthat-extension/spec.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: specs/001-capthat-extension/data-model.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: specs/001-capthat-extension/research.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: specs/001-capthat-extension/quickstart.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---



---


Reading the contract files:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: specs/001-capthat-extension/contracts/api-contracts.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: specs/001-capthat-extension/contracts/message-contracts.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: specs/001-capthat-extension/contracts/messages.ts</summary>

</details>
</tool-use>

---



---


Regenerating tasks.md from the design documents. Creating the task list:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: specs/001-capthat-extension/tasks.md</summary>

</details>
</tool-use>

---



---


Regenerating tasks.md from the design documents, organized by user story with proper formatting:


---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** ‚Ä¢ Edit file: specs/001-capthat-extension/tasks.md</summary>

**Chunk 1**
Lines added: 14, lines removed: 14

```diff
@@ -62,27 +62,27 @@
  ### Type Definitions
  
- - [ ] T015 [P] Define TypeScript types at &#96;extension/types/index.ts&#96; (CapturedItem, CapBoard, ImageReference, BoardMetadata, GridConfig, ExportManifest, ExportItemReference, BlobReference interfaces)
- - [ ] T016 [P] Define shared types at &#96;shared/types/index.ts&#96; for extension and web compatibility (export CapturedItem, CapBoard, ImageReference, BoardMetadata, GridConfig, ExportManifest, ExportItemReference interfaces matching extension types)
+ - [ ] T015 [P] Define TypeScript types at &#96;extension/types/index.ts&#96; (CapturedItem interface with id: string, imageReference: ImageReference, sourceUrl: string, timestamp: number, metadata?: Record&lt;string, unknown&gt;, qualityIndicator?: 'url-only' | 'blob' | 'fallback'; CapBoard interface with items: CapturedItem[], metadata: BoardMetadata, gridConfig: GridConfig, exportHistory?: ExportManifest[]; ImageReference interface with urlOrBlob: string | BlobReference, thumbnail?: string, dimensions?: { width: number; height: number }, fallbackIndicator?: boolean; BoardMetadata interface with creationDate: number, lastModified: number, version: string; GridConfig interface with slots: number, columns: number, virtualScrolling: boolean; ExportManifest interface with boardMetadata: BoardMetadata, itemReferences: ExportItemReference[], exportTimestamp: number, formatVersion: string; ExportItemReference interface with itemId: string, filename?: string, imageUrl?: string, metadata: Record&lt;string, unknown&gt;; BlobReference type for IndexedDB blob keys)
+ - [ ] T016 [P] Define shared types at &#96;shared/types/index.ts&#96; for extension and web compatibility (export CapturedItem, CapBoard, ImageReference, BoardMetadata, GridConfig, ExportManifest, ExportItemReference interfaces matching extension types from T015, ensure types are compatible for Next.js API integration)
...
- - [ ] T017 [P] Implement chrome.storage.local adapter at &#96;extension/storage/storage-adapter.ts&#96; (save CapBoard metadata to chrome.storage.local with key 'capBoard', load board from storage, handle errors)
- - [ ] T018 [P] Implement IndexedDB adapter at &#96;extension/storage/indexeddb-adapter.ts&#96; for blob storage (open IndexedDB database 'capthat', create 'images' object store, store/retrieve Blob objects)
- - [ ] T019 [P] Create storage interface/abstraction at &#96;extension/storage/storage-interface.ts&#96; (define IStorageAdapter interface with saveBoard, loadBoard, saveBlob, getBlob methods)
- - [ ] T020 [P] Implement storage quota monitoring in &#96;extension/storage/storage-adapter.ts&#96; (check chrome.storage.quota.bytesUsed, emit warning at 80%, prevent saves when quota exceeded)
- - [ ] T021 [P] Implement board size limit enforcement (100 items) in &#96;extension/storage/storage-adapter.ts&#96; (validate items.length &lt;= 100 before save, throw error if limit exceeded)
- - [ ] T022 [P] Implement warning threshold (80 items) in &#96;extension/storage/storage-adapter.ts&#96; (check items.length &gt;= 80, emit warning event when threshold reached)
+ - [ ] T017 [P] Implement chrome.storage.local adapter at &#96;extension/storage/storage-adapter.ts&#96; (save CapBoard metadata to chrome.storage.local with key 'capBoard', load board from storage, handle chrome.storage errors with try-catch, return CapBoard object or null if not found)
+ - [ ] T018 [P] Implement IndexedDB adapter at &#96;extension/storage/indexeddb-adapter.ts&#96; for blob storage (open IndexedDB database 'capthat', create 'images' object store if needed, store Blob objects with unique keys, retrieve blobs by key, handle IndexedDB errors, return Blob or null)
+ - [ ] T019 [P] Create storage interface/abstraction at &#96;extension/storage/storage-interface.ts&#96; (define IStorageAdapter interface with saveBoard(board: CapBoard): Promise&lt;void&gt;, loadBoard(): Promise&lt;CapBoard | null&gt;, saveBlob(key: string, blob: Blob): Promise&lt;void&gt;, getBlob(key: string): Promise&lt;Blob | null&gt;, implement interface for both chrome.storage.local and IndexedDB adapters)
+ - [ ] T020 [P] Implement storage quota monitoring in &#96;extension/storage/storage-adapter.ts&#96; (check chrome.storage.quota.bytesUsed and chrome.storage.quota.bytesInUse, calculate usage percentage, emit warning event or throw error when usage exceeds 80%, prevent saves when quota exceeded)
+ - [ ] T021 [P] Implement board size limit enforcement (100 items) in &#96;extension/storage/storage-adapter.ts&#96; (validate items.length &lt;= 100 before save operation, throw error with user-friendly message if limit exceeded, prevent save when board has 100 items)
+ - [ ] T022 [P] Implement warning threshold (80 items) in &#96;extension/storage/storage-adapter.ts&#96; (check items.length &gt;= 80 before save, emit warning event or callback when threshold reached, allow save but notify UI to show warning message)
...
- - [ ] T023 [P] Implement URL validator at &#96;extension/validation/url-validator.ts&#96; (validate URL string, block javascript: scheme, allow http://, https://, data: schemes only, return boolean or throw ValidationError)
- - [ ] T024 [P] Implement image validator at &#96;extension/validation/image-validator.ts&#96; (validate MIME types: image/jpeg, image/png, image/gif, image/webp, enforce 10MB size limit, enforce 10MP dimension limit)
- - [ ] T025 [P] Implement schema validator at &#96;extension/validation/schema-validator.ts&#96; (validate CapturedItem structure, validate CapBoard structure with items.length &lt;= 100, return boolean or throw ValidationError)
- - [ ] T026 [P] Create shared URL validator at &#96;shared/validators/url.ts&#96; for reuse by extension and web app (export URL validation function matching T023 implementation)
+ - [ ] T023 [P] Implement URL validator at &#96;extension/validation/url-validator.ts&#96; (validate URL string, block javascript: scheme and other dangerous schemes, allow http://, https://, and data: schemes only, return boolean or throw ValidationError with user-friendly message, validate sourceUrl for CapturedItem)
+ - [ ] T024 [P] Implement image validator at &#96;extension/validation/image-validator.ts&#96; (validate MIME types: image/jpeg, image/png, image/gif, image/webp only, enforce 10MB size limit per image, enforce 10MP dimension limit (width * height &lt;= 10,000,000), validate Blob or URL input, return boolean or throw ValidationError with specific reason)
+ - [ ] T025 [P] Implement schema validator at &#96;extension/validation/schema-validator.ts&#96; (validate CapturedItem structure: required fields id, imageReference, sourceUrl, timestamp, validate id is non-empty string, validate sourceUrl via URL validator, validate timestamp is positive number, validate metadata is serializable JSON object, validate CapBoard structure: items array length &lt;= 100, items contain valid CapturedItem objects, metadata and gridConfig are valid, return boolean or throw ValidationError)
+ - [ ] T026 [P] Create shared URL validator at &#96;shared/validators/url.ts&#96; for reuse by extension and web app (export URL validation function matching T023 implementation, ensure compatibility with both extension and Next.js API, validate http/https/data schemes, block javascript: and dangerous schemes)
...
- - [ ] T027 [P] Define message types at &#96;extension/types/messages.ts&#96; (define CaptureRequestMessage, CaptureResponseMessage, StorageUpdateMessage, ExportRequestMessage, ExportResponseMessage, BoardUpdateMessage, ErrorMessage, define Message union type, export type guards)
- - [ ] T028 [P] Implement message validation in &#96;extension/background/service-worker.ts&#96; message handlers (validate message shape, validate message type, validate payload structure, validate payload content, reject invalid messages with ErrorMessage response)
+ - [ ] T027 [P] Define message types at &#96;extension/types/messages.ts&#96; (define CaptureRequestMessage with type: 'CAPTURE_REQUEST', payload: { imageUrl: string, sourceUrl: string, metadata?: Record&lt;string, unknown&gt; }; CaptureResponseMessage with type: 'CAPTURE_RESPONSE', payload: { success: boolean, itemId?: string, error?: string, errorCategory?: 'permission' | 'cors' | 'storage' | 'validation' }; StorageUpdateMessage with type: 'STORAGE_UPDATE', payload: { action: 'add' | 'remove' | 'clear' | 'update', item?: CapturedItem, board?: CapBoard }; ExportRequestMessage with type: 'EXPORT_REQUEST', payload: { format: 'json' | 'zip' | 'individual', options?: ExportOptions }; ExportResponseMessage with type: 'EXPORT_RESPONSE', payload: { success: boolean, filename?: string, error?: string, skippedCount?: number }; BoardUpdateMessage with type: 'BOARD_UPDATE', payload: { action: 'remove' | 'clear', itemId?: string }; ErrorMessage with type: 'ERROR', payload: { message: string, category: ErrorCategory, retryable: boolean }; define Message union type, export type guards for each message type, export isValidMessage function)
+ - [ ] T028 [P] Implement message validation in &#96;extension/background/service-worker.ts&#96; message handlers (validate message shape: check type field exists and is string, validate message type matches known types from T027, validate payload structure matches message type requirements, validate payload content: URLs via URL validator, itemId format, action values, reject invalid messages with ErrorMessage response, add validation before processing any incoming messages)
  
  **Checkpoint**: Foundation ready - user story implementation can now begin in parallel
```

**Chunk 2**
Lines added: 535, lines removed: 454

```diff
@@ -96,461 +96,542 @@
  **Independent Test**: Run build command, open chrome://extensions, load unpacked extension, verify it appears with icon and name "CapThat", reload reflects code changes after rebuild.
  
- - [ ] T029 [US1] Add extension icon assets to &#96;extension/icons/&#96; directory (16x16, 48x48, 128x128 PNG files)
- - [ ] T030 [US1] Configure icon paths in &#96;extension/manifest.json&#96; (icons field with all sizes)
- - [ ] T031 [US1] Set extension name to "CapThat" in &#96;extension/manifest.json&#96; (name field)
- - [ ] T032 [US1] Verify build output generates valid extension package at &#96;build/extension/&#96;
- - [ ] T033 [US1] Test extension reload functionality (make code change, rebuild, reload extension, verify changes appear)
+ **Acceptance Criteria**:
+ - Extension loads without errors
+ - Extension shows icon and name "CapThat" in extensions list
+ - Reloading extension after code changes reflects updates
...
- **Checkpoint**: At this point, User Story 1 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 4: User Story 2 - Show CapThat Panel UI (Priority: P1) üéØ MVP
- 
- **Goal**: Users can open the CapThat panel and see the complete UI with title, grid, and action buttons.
- 
- **Independent Test**: Open extension panel (via action button, side panel, or injected overlay), verify UI displays correctly with title "CapThat!", empty grid with N slots, buttons (Clear, Export JSON, Export CapBoard, Export Individual Caps), and styled with Tailwind at desktop widths.
- 
- - [ ] T034 [P] [US2] Setup React and Tailwind CSS in &#96;extension/ui/side-panel.tsx&#96; (import React, configure Tailwind)
- - [ ] T035 [P] [US2] Create Header component at &#96;extension/ui/components/Header.tsx&#96; (display "CapThat!" title)
- - [ ] T036 [P] [US2] Create ImageGrid component at &#96;extension/ui/components/ImageGrid.tsx&#96; (empty grid with N slots, placeholder support)
- - [ ] T037 [P] [US2] Create ActionButton component at &#96;extension/ui/components/ActionButton.tsx&#96; (reusable button with states, hover effects)
- - [ ] T038 [P] [US2] Create CapBoardPanel component at &#96;extension/ui/components/CapBoardPanel.tsx&#96; (main panel layout with Header, ImageGrid, action buttons)
- - [ ] T039 [US2] Implement side panel entry point in &#96;extension/ui/side-panel.tsx&#96; (render CapBoardPanel, mount React app)
- - [ ] T040 [US2] Configure side panel in &#96;extension/manifest.json&#96; (side_panel field with default_path)
- - [ ] T041 [US2] Implement extension action button handler in &#96;extension/background/service-worker.ts&#96; (open side panel on click)
- - [ ] T042 [US2] Add placeholder text to empty grid slots in &#96;extension/ui/components/ImageGrid.tsx&#96; ("Click Cap! to capture images")
- - [ ] T043 [US2] Apply dark mode styling in &#96;extension/ui/globals.css&#96; (dark background, light text, glassmorphism effects)
- - [ ] T044 [US2] Apply Tailwind styling to all components (teal/cyan accents, rounded corners, soft glows, transitions)
- 
- **Checkpoint**: At this point, User Story 2 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 5: User Story 3 - Detect Capturable Images on Page (Priority: P2)
- 
- **Goal**: Extension identifies and marks capturable images on web pages without breaking page layout.
- 
- **Independent Test**: Visit page with images, verify extension injects capture controls or enables capture mode, verify page layout not broken, verify no console errors on common websites.
- 
- - [ ] T045 [P] [US3] Implement image detection logic in &#96;extension/content/content-script.ts&#96; (scan for &#96;&lt;img&gt;&#96; elements, filter valid sources)
- - [ ] T046 [US3] Inject capture controls into page in &#96;extension/content/content-script.ts&#96; (add "Cap!" buttons to image tiles, use isolated world)
- - [ ] T047 [US3] Ensure content script uses isolated world in &#96;extension/manifest.json&#96; (verify world: "ISOLATED" for content scripts)
- - [ ] T048 [US3] Implement CSS injection for capture controls in &#96;extension/content/content-script.ts&#96; (style buttons, ensure no layout breakage)
- - [ ] T049 [US3] Add error handling for content script injection in &#96;extension/content/content-script.ts&#96; (catch errors, log to console, prevent page breakage)
- - [ ] T050 [US3] Test on common websites (e-commerce, social media, content sites) and verify no console errors
- 
- **Checkpoint**: At this point, User Story 3 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 6: User Story 4 - Capture Image Using "Cap!" Button (Priority: P2)
- 
- **Goal**: Users can click "Cap!" on an image and it appears in the CapThat panel within 2 seconds.
- 
- **Independent Test**: Click "Cap!" on an image, verify item appears in CapThat panel within 2 seconds with all required metadata, verify duplicate captures are handled appropriately, verify board limit warnings and enforcement.
- 
- - [ ] T051 [US4] Implement "Cap!" button click handler in &#96;extension/content/content-script.ts&#96; (send CAPTURE_REQUEST message to service worker)
- - [ ] T052 [US4] Implement capture request handler in &#96;extension/background/service-worker.ts&#96; (receive CAPTURE_REQUEST, validate input)
- - [ ] T053 [US4] Implement image fetch logic in &#96;extension/background/service-worker.ts&#96; (attempt to fetch image blob, handle CORS)
- - [ ] T054 [US4] Implement content hash calculation in &#96;extension/background/service-worker.ts&#96; (calculate hash for duplicate detection)
- - [ ] T055 [US4] Implement duplicate detection in &#96;extension/background/service-worker.ts&#96; (check content hash against existing items)
- - [ ] T056 [US4] Create CapturedItem from capture in &#96;extension/background/service-worker.ts&#96; (generate UUID, create ImageReference, set timestamp)
- - [ ] T057 [US4] Save captured item to storage in &#96;extension/background/service-worker.ts&#96; (use storage adapters, enforce 100 item limit)
- - [ ] T058 [US4] Send storage update message to UI in &#96;extension/background/service-worker.ts&#96; (broadcast STORAGE_UPDATE with new item)
- - [ ] T059 [US4] Implement capture response handler in &#96;extension/content/content-script.ts&#96; (receive CAPTURE_RESPONSE, show feedback)
- - [ ] T060 [US4] Update ImageGrid to receive new items in &#96;extension/ui/components/ImageGrid.tsx&#96; (listen for STORAGE_UPDATE messages, add items to grid)
- - [ ] T061 [US4] Implement board limit check in &#96;extension/background/service-worker.ts&#96; (check item count before save, emit warning at 80, prevent at 100)
- - [ ] T062 [US4] Display board limit warning in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (show warning message at 80 items)
- 
- **Checkpoint**: At this point, User Story 4 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 7: User Story 5 - View Captured Items in Grid (Priority: P2)
- 
- **Goal**: Users can see captured items rendered as thumbnails in grid slots with metadata, and board state persists.
- 
- **Independent Test**: Capture multiple items, verify they render as thumbnails in grid slots with metadata, verify board state persists across refreshes and browser restarts.
- 
- - [ ] T063 [P] [US5] Create ImageCard component at &#96;extension/ui/components/ImageCard.tsx&#96; (display thumbnail, metadata, handle loading states)
- - [ ] T064 [US5] Implement thumbnail generation in &#96;extension/background/service-worker.ts&#96; (create base64 thumbnails for grid display)
- - [ ] T065 [US5] Update ImageGrid to render ImageCard components in &#96;extension/ui/components/ImageGrid.tsx&#96; (map items to cards, handle empty slots)
- - [ ] T066 [US5] Implement virtual scrolling in &#96;extension/ui/components/ImageGrid.tsx&#96; (fixed slots, content scrolls within slots for 100+ items)
- - [ ] T067 [US5] Load board state on panel open in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (request board from service worker on mount)
- - [ ] T068 [US5] Implement board load handler in &#96;extension/background/service-worker.ts&#96; (load board from storage, send to UI)
- - [ ] T069 [US5] Verify persistence across browser restart (capture items, close browser, reopen, verify items still visible)
- 
- **Checkpoint**: At this point, User Story 5 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 8: User Story 6 - Remove a Captured Item (Priority: P3)
- 
- **Goal**: Users can remove individual items from the board without affecting other items.
- 
- **Independent Test**: Remove an individual item, verify it disappears immediately, verify it's removed from storage, verify other items remain intact.
- 
- - [ ] T070 [P] [US6] Add remove button to ImageCard component in &#96;extension/ui/components/ImageCard.tsx&#96; (X button with hover state)
- - [ ] T071 [US6] Implement remove item handler in &#96;extension/ui/components/ImageCard.tsx&#96; (send BOARD_UPDATE message with remove action)
- - [ ] T072 [US6] Implement remove item handler in &#96;extension/background/service-worker.ts&#96; (receive BOARD_UPDATE, remove item from board, save to storage)
- - [ ] T073 [US6] Broadcast storage update after removal in &#96;extension/background/service-worker.ts&#96; (send STORAGE_UPDATE with remove action)
- - [ ] T074 [US6] Update ImageGrid to handle item removal in &#96;extension/ui/components/ImageGrid.tsx&#96; (remove item from grid on STORAGE_UPDATE)
- 
- **Checkpoint**: At this point, User Story 6 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 9: User Story 7 - Clear the Entire Cap Board (Priority: P3)
- 
- **Goal**: Users can clear the entire board with confirmation, removing all items from UI and storage.
- 
- **Independent Test**: Click "Clear Cap Board", confirm action, verify all items removed from UI and storage.
- 
- - [ ] T075 [US7] Implement clear button handler in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (show confirmation modal or confirm prompt)
- - [ ] T076 [US7] Create confirmation modal component in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (confirm/cancel buttons, glassmorphism styling)
- - [ ] T077 [US7] Implement clear board handler in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (send BOARD_UPDATE message with clear action on confirm)
- - [ ] T078 [US7] Implement clear board handler in &#96;extension/background/service-worker.ts&#96; (receive BOARD_UPDATE, clear items array, save empty board to storage)
- - [ ] T079 [US7] Broadcast storage update after clear in &#96;extension/background/service-worker.ts&#96; (send STORAGE_UPDATE with clear action and empty board)
- - [ ] T080 [US7] Update ImageGrid to handle board clear in &#96;extension/ui/components/ImageGrid.tsx&#96; (clear all items on STORAGE_UPDATE clear action)
- 
- **Checkpoint**: At this point, User Story 7 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 10: User Story 8 - Persist Board Using Extension Storage (Priority: P2)
- 
- **Goal**: Board data is automatically saved and loaded, with graceful error handling.
- 
- **Independent Test**: Capture items, close and reopen panel, verify items load automatically. Test storage errors handled gracefully.
- 
- - [ ] T081 [US8] Implement automatic save on capture in &#96;extension/background/service-worker.ts&#96; (save board to chrome.storage.local after each capture)
- - [ ] T082 [US8] Implement automatic save on remove in &#96;extension/background/service-worker.ts&#96; (save board to chrome.storage.local after each removal)
- - [ ] T083 [US8] Implement automatic save on clear in &#96;extension/background/service-worker.ts&#96; (save empty board to chrome.storage.local after clear)
- - [ ] T084 [US8] Implement board load on panel open in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (request board from service worker on component mount)
- - [ ] T085 [US8] Implement board load handler in &#96;extension/background/service-worker.ts&#96; (load board from chrome.storage.local, load blobs from IndexedDB, send to UI)
- - [ ] T086 [US8] Implement error handling for storage operations in &#96;extension/background/service-worker.ts&#96; (catch storage errors, send ERROR message with user-friendly text)
- - [ ] T087 [US8] Display storage errors in UI in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (show non-blocking toast for storage errors)
- 
- **Checkpoint**: At this point, User Story 8 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 11: User Story 9 - Export Board Metadata as JSON (Priority: P3)
- 
- **Goal**: Users can export board data as a valid JSON file with all required metadata fields.
- 
- **Independent Test**: Click "Export JSON", verify .json file downloads with all required fields for each item, verify JSON validates (no circular refs, valid UTF-8).
- 
- - [ ] T088 [US9] Implement export JSON button handler in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (send EXPORT_REQUEST message with format: 'json')
- - [ ] T089 [US9] Implement JSON export logic in &#96;extension/export/json-export.ts&#96; (serialize board to JSON, handle circular refs, ensure valid UTF-8)
- - [ ] T090 [US9] Implement export request handler in &#96;extension/background/service-worker.ts&#96; (receive EXPORT_REQUEST, call export function, trigger download)
- - [ ] T091 [US9] Implement file download in &#96;extension/background/service-worker.ts&#96; (use chrome.downloads API or createObjectURL for JSON download)
- - [ ] T092 [US9] Send export response to UI in &#96;extension/background/service-worker.ts&#96; (send EXPORT_RESPONSE with success/failure)
- - [ ] T093 [US9] Handle export response in UI in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (show success/error message)
- 
- **Checkpoint**: At this point, User Story 9 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 12: User Story 10 - Export Individual Captured Images (Priority: P3)
- 
- **Goal**: Users can export each captured image as separate files with consistent, unique filenames.
- 
- **Independent Test**: Click "Export Individual Caps", verify multiple image files download with consistent filenames (cap-&lt;timestamp&gt;-&lt;id&gt;.png), verify CORS-blocked images are skipped and reported.
- 
- - [ ] T094 [US10] Implement export individual images button handler in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (send EXPORT_REQUEST message with format: 'individual')
- - [ ] T095 [US10] Implement filename sanitizer in &#96;extension/export/filename-sanitizer.ts&#96; (remove /, \, .., etc., ensure unique filenames)
- - [ ] T096 [US10] Implement individual image export logic in &#96;extension/export/json-export.ts&#96; (iterate items, download each image, handle CORS failures)
- - [ ] T097 [US10] Implement image download with retry in &#96;extension/export/json-export.ts&#96; (attempt fetch, handle CORS, skip if blocked)
- - [ ] T098 [US10] Track skipped images in export in &#96;extension/export/json-export.ts&#96; (count CORS-blocked images)
- - [ ] T099 [US10] Send export response with skipped count in &#96;extension/background/service-worker.ts&#96; (include skippedCount in EXPORT_RESPONSE)
- - [ ] T100 [US10] Display export summary in UI in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (show skipped count if &gt; 0)
- 
- **Checkpoint**: At this point, User Story 10 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 13: User Story 11 - Export Full Cap Board as ZIP (Priority: P3)
- 
- **Goal**: Users can export the entire board as a ZIP file containing images folder and board.json manifest.
- 
- **Independent Test**: Click "Export CapBoard", verify .zip file downloads containing /images/ folder and board.json, verify export completes for boards up to 50 items without crashing.
- 
- - [ ] T101 [US11] Implement export ZIP button handler in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (send EXPORT_REQUEST message with format: 'zip')
- - [ ] T102 [US11] Install JSZip dependency in &#96;package.json&#96; (add jszip package)
- - [ ] T103 [US11] Implement ZIP export logic in &#96;extension/export/zip-export.ts&#96; (create ZIP with JSZip, add images to /images/ folder, add board.json)
- - [ ] T104 [US11] Generate board.json manifest in &#96;extension/export/zip-export.ts&#96; (create ExportManifest with board metadata, item references, export timestamp)
- - [ ] T105 [US11] Add images to ZIP in &#96;extension/export/zip-export.ts&#96; (iterate items, add images to /images/ folder, handle CORS-blocked images)
- - [ ] T106 [US11] Implement ZIP download in &#96;extension/background/service-worker.ts&#96; (generate ZIP blob, trigger download)
- - [ ] T107 [US11] Handle large boards (50+ items) in &#96;extension/export/zip-export.ts&#96; (stream or chunk processing to prevent memory issues)
- - [ ] T108 [US11] Send export response to UI in &#96;extension/background/service-worker.ts&#96; (send EXPORT_RESPONSE with success/failure)
- 
- **Checkpoint**: At this point, User Story 11 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 14: User Story 12 - Handle CORS-Blocked Images with Fallback (Priority: P2)
- 
- **Goal**: Extension captures images even when direct download fails, using fallback strategies.
- 
- **Independent Test**: Attempt to capture CORS-blocked images, verify fallback mechanisms work (URL storage, blob fetch attempt, optional tab capture), verify items still added to board with usable thumbnails, verify users informed about fallback usage.
- 
- - [ ] T109 [US12] Implement CORS fallback strategy in &#96;extension/background/service-worker.ts&#96; (try URL storage first, then blob fetch, then tab capture)
- - [ ] T110 [US12] Implement URL-only storage fallback in &#96;extension/background/service-worker.ts&#96; (store image URL when blob fetch fails)
- - [ ] T111 [US12] Implement blob fetch attempt in &#96;extension/background/service-worker.ts&#96; (attempt fetch with CORS handling, catch errors)
- - [ ] T112 [US12] Set qualityIndicator on CapturedItem in &#96;extension/background/service-worker.ts&#96; (set to 'url-only', 'blob', or 'fallback' based on capture method)
- - [ ] T113 [US12] Display fallback indicator in ImageCard in &#96;extension/ui/components/ImageCard.tsx&#96; (show badge or tooltip when qualityIndicator is 'url-only' or 'fallback')
- - [ ] T114 [US12] Generate thumbnail from URL when blob unavailable in &#96;extension/background/service-worker.ts&#96; (create thumbnail from URL for grid display)
- 
- **Checkpoint**: At this point, User Story 12 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 15: User Story 13 - Show Status Feedback for Actions (Priority: P3)
- 
- **Goal**: Users receive confirmation and error feedback for all actions without blocking interaction.
- 
- **Independent Test**: Perform various actions (capture, export, clear), verify appropriate feedback messages appear (toast notifications), verify no blocking alerts except clear confirmation.
- 
- - [ ] T115 [P] [US13] Create toast notification component in &#96;extension/ui/components/Toast.tsx&#96; (non-blocking toast with message, auto-dismiss, retry button support)
- - [ ] T116 [US13] Implement toast state management in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (toast queue, show/hide logic)
- - [ ] T117 [US13] Show "Captured" toast on successful capture in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (listen for STORAGE_UPDATE add action)
- - [ ] T118 [US13] Show "Exported successfully" toast on export success in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (listen for EXPORT_RESPONSE success)
- - [ ] T119 [US13] Show error toast with retry button on failure in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (listen for ERROR messages, show retry button if retryable)
- - [ ] T120 [US13] Implement retry logic in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (retry failed action on retry button click)
- - [ ] T121 [US13] Format error messages by category in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (show user-friendly messages for permission/CORS/storage/validation errors)
- 
- **Checkpoint**: At this point, User Story 13 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 16: User Story 14 - Send Captured Items to Local Next.js API (Priority: P4 - Optional Phase 2)
- 
- **Goal**: Extension can send captured items to local Next.js app when available, with graceful fallback.
- 
- **Independent Test**: Capture items with local app running, verify items posted to http://localhost:3000/api/capture. Test with app not running, verify fallback to extension storage. Test app detection, verify "Local app not detected" message.
- 
- - [ ] T122 [US14] Create Next.js API route at &#96;app/api/capture/route.ts&#96; (POST handler, validate origin, accept capture payload)
- - [ ] T123 [US14] Implement CORS handling in Next.js API in &#96;app/api/capture/route.ts&#96; (allow chrome-extension:// origins)
- - [ ] T124 [US14] Implement payload validation in Next.js API in &#96;app/api/capture/route.ts&#96; (validate itemId, sourceUrl, timestamp, imageReference)
- - [ ] T125 [US14] Store captured items in Next.js in &#96;app/api/capture/route.ts&#96; (save to database or file system)
- - [ ] T126 [US14] Create board page at &#96;app/board/page.tsx&#96; (display captured items from Next.js storage)
- - [ ] T127 [US14] Implement local app detection in &#96;extension/background/service-worker.ts&#96; (ping http://localhost:3000/api/capture to check availability)
- - [ ] T128 [US14] Implement API client in &#96;extension/background/service-worker.ts&#96; (send POST request to http://localhost:3000/api/capture with captured item)
- - [ ] T129 [US14] Implement origin validation in &#96;extension/background/service-worker.ts&#96; (validate requests only go to http://localhost:3000)
- - [ ] T130 [US14] Implement fallback to extension storage in &#96;extension/background/service-worker.ts&#96; (if API unavailable, use extension storage)
- - [ ] T131 [US14] Show "Local app not detected" message in UI in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (non-blocking message when app unavailable)
- - [ ] T132 [US14] Handle API errors gracefully in &#96;extension/background/service-worker.ts&#96; (catch network errors, validation errors, fallback to extension storage)
- 
- **Checkpoint**: At this point, User Story 14 should be fully functional and testable independently
- 
- ---
- 
- ## Phase 17: Polish &amp; Cross-Cutting Concerns
- 
- **Purpose**: Improvements that affect multiple user stories.
- 
- - [ ] T133 [P] Update documentation in &#96;README.md&#96; (extension setup, usage, development guide)
- - [ ] T134 [P] Code cleanup and refactoring (review all files, remove dead code, improve naming)
- - [ ] T135 [P] Performance optimization (optimize image loading, virtual scrolling, storage operations)
- - [ ] T136 [P] Security review (verify CSP compliance, input validation, storage quota handling)
- - [ ] T137 [P] Accessibility improvements (keyboard navigation, ARIA labels, contrast checks)
- - [ ] T138 [P] Error handling improvements (comprehensive error messages, retry logic, logging)
- - [ ] T139 [P] Run quickstart.md validation (test all user scenarios from quickstart.md)
- - [ ] T140 [P] Final testing across all user stories (end-to-end testing, browser compatibility)
- 
- ---
- 
- ## Dependencies &amp; Execution Order
- 
- ### Phase Dependencies
- 
- - **Setup (Phase 1)**: No dependencies - can start immediately
- - **Foundational (Phase 2)**: Depends on Setup completion - BLOCKS all user stories
- - **User Stories (Phase 3-16)**: All depend on Foundational phase completion
-   - User stories can then proceed in parallel (if staffed)
-   - Or sequentially in priority order (P1 ‚Üí P2 ‚Üí P3 ‚Üí P4)
- - **Polish (Phase 17)**: Depends on all desired user stories being complete
- 
- ### User Story Dependencies
- 
- - **User Story 1 (P1)**: Can start after Foundational (Phase 2) - No dependencies on other stories
- - **User Story 2 (P1)**: Can start after Foundational (Phase 2) - No dependencies on other stories
- - **User Story 3 (P2)**: Can start after Foundational (Phase 2) - No dependencies on other stories
- - **User Story 4 (P2)**: Depends on User Story 2 (needs panel UI) and User Story 3 (needs image detection) - Can start after US2 and US3
- - **User Story 5 (P2)**: Depends on User Story 4 (needs captured items) - Can start after US4
- - **User Story 6 (P3)**: Depends on User Story 5 (needs grid display) - Can start after US5
- - **User Story 7 (P3)**: Depends on User Story 5 (needs grid display) - Can start after US5
- - **User Story 8 (P2)**: Depends on User Story 4 (needs capture functionality) - Can start after US4
- - **User Story 9 (P3)**: Depends on User Story 5 (needs board data) - Can start after US5
- - **User Story 10 (P3)**: Depends on User Story 5 (needs board data) - Can start after US5
- - **User Story 11 (P3)**: Depends on User Story 5 (needs board data) - Can start after US5
- - **User Story 12 (P2)**: Depends on User Story 4 (needs capture functionality) - Can start after US4
- - **User Story 13 (P3)**: Depends on User Stories 4, 9, 10, 11 (needs actions to provide feedback for) - Can start after US4
- - **User Story 14 (P4)**: Depends on User Story 4 (needs capture functionality) - Optional Phase 2, can start after US4
- 
- ### Within Each User Story
- 
- - Models/types before services
- - Services before UI components
- - Core implementation before integration
- - Story complete before moving to next priority
- 
- ### Parallel Opportunities
- 
- - All Setup tasks (T001-T014) can run in parallel where they touch different files
- - All Foundational tasks marked [P] (T015-T028) can run in parallel
- - Once Foundational phase completes, User Stories 1, 2, and 3 can start in parallel
- - User Stories 4, 8, and 12 can start in parallel after US2 and US3 complete
- - User Stories 6, 7, 9, 10, 11 can start in parallel after US5 completes
- - All tasks marked [P] within a user story can run in parallel
- - Different user stories can be worked on in parallel by different team members
- 
- ---
- 
- ## Parallel Example: User Story 2
- 
- &#96;&#96;&#96;bash
- # Launch all component creation tasks in parallel:
- Task: "Create Header component at extension/ui/components/Header.tsx"
- Task: "Create ImageGrid component at extension/ui/components/ImageGrid.tsx"
- Task: "Create ActionButton component at extension/ui/components/ActionButton.tsx"
- Task: "Create CapBoardPanel component at extension/ui/components/CapBoardPanel.tsx"
- &#96;&#96;&#96;
- 
- ---
- 
- ## Parallel Example: User Story 4
- 
- &#96;&#96;&#96;bash
- # Launch foundational tasks in parallel (after Phase 2):
- Task: "Implement 'Cap!' button click handler in extension/content/content-script.ts"
- Task: "Implement capture request handler in extension/background/service-worker.ts"
- Task: "Implement image fetch logic in extension/background/service-worker.ts"
- Task: "Implement content hash calculation in extension/background/service-worker.ts"
- &#96;&#96;&#96;
+ - [ ] T029 [US1] Create extension icon assets and configure in &#96;extension/manifest.json&#96; (add icons field with 16x16, 48x48, 128x128 icon paths)
+ - [ ] T030 [US1] Configure extension name "CapThat" in &#96;extension/manifest.json&#96; (set name field to "CapThat")
+ - [ ] T031 [US1] Verify extension loads without console errors in Chrome DevTools
+ - [ ] T032 [US1] Test extension reload functionality (make code change, rebuild, reload extension, verify changes appear)
+ - [ ] T033 [US1] Verify extension appears in chrome://extensions list with correct name and icon
+ 
+ **Checkpoint**: At this point, User Story 1 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 4: User Story 2 - Show CapThat Panel UI (Priority: P1) üéØ MVP
+ 
+ **Goal**: Panel opens and displays complete UI (title, grid, buttons) within 1 second.
+ 
+ **Independent Test**: Open extension panel (via action button, side panel, or injected overlay), verify UI displays correctly with title, grid, and action buttons, confirm it's styled and usable at desktop widths.
+ 
+ **Acceptance Criteria**:
+ - Panel opens within 1 second
+ - Title "CapThat!" is visible
+ - Empty grid with N slots (e.g., 10) is visible
+ - Placeholder text appears: "Click Cap! to capture images"
+ - Action buttons are visible: Clear, Export JSON, Export CapBoard, Export Individual Caps
+ - UI is styled with Tailwind CSS
+ - UI is usable at desktop width (1024px+)
+ 
+ ### UI Components
+ 
+ - [ ] T034 [P] [US2] Create Header component at &#96;extension/ui/components/Header.tsx&#96; (browser-like header with title "CapThat!", styled with Tailwind dark mode, glassmorphism effects, teal/cyan accents)
+ - [ ] T035 [P] [US2] Create ImageGrid component at &#96;extension/ui/components/ImageGrid.tsx&#96; (grid layout with N slots, placeholder support, virtual scrolling configuration, Tailwind styling)
+ - [ ] T036 [P] [US2] Create ImageCard component at &#96;extension/ui/components/ImageCard.tsx&#96; (individual image card with thumbnail display, metadata display, hover states, Tailwind styling)
+ - [ ] T037 [P] [US2] Create CapBoardPanel component at &#96;extension/ui/components/CapBoardPanel.tsx&#96; (main panel component with Header, ImageGrid for captured items, action buttons, empty state with placeholder text "Click Cap! to capture images", Tailwind styling)
+ - [ ] T038 [P] [US2] Create ActionButton component at &#96;extension/ui/components/ActionButton.tsx&#96; (reusable button component with states: default, hover, active, disabled, keyboard accessible, Tailwind styling with teal/cyan accents, smooth transitions)
+ 
+ ### Panel Integration
+ 
+ - [ ] T039 [US2] Integrate React components in &#96;extension/ui/side-panel.tsx&#96; (import and render CapBoardPanel, setup React root, configure Tailwind CSS, handle side panel lifecycle)
+ - [ ] T040 [US2] Configure side panel in &#96;extension/manifest.json&#96; (add side_panel field with default_path: "ui/side-panel.html", configure side panel action)
+ - [ ] T041 [US2] Setup Tailwind CSS configuration at &#96;extension/ui/tailwind.config.js&#96; (configure dark mode, glassmorphism utilities, teal/cyan color palette, responsive breakpoints)
+ - [ ] T042 [US2] Import global styles at &#96;extension/ui/globals.css&#96; (Tailwind directives, dark mode base styles, custom utilities for glassmorphism)
+ - [ ] T043 [US2] Implement empty grid placeholder in &#96;extension/ui/components/ImageGrid.tsx&#96; (display placeholder text "Click Cap! to capture images" when items array is empty, style with Tailwind)
+ - [ ] T044 [US2] Add action buttons to CapBoardPanel: Clear Cap Board, Export JSON, Export CapBoard, Export Individual Caps (wire up button components, add to panel layout, style with Tailwind)
+ 
+ **Checkpoint**: At this point, User Story 2 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 5: User Story 3 - Detect Capturable Images on Page (Priority: P2)
+ 
+ **Goal**: Extension detects and marks capturable images on pages without breaking page functionality.
+ 
+ **Independent Test**: Visit a page with images and verify that the extension injects capture controls or enables capture mode without breaking page layout or producing console errors.
+ 
+ **Acceptance Criteria**:
+ - Extension injects capture controls or enables capture mode
+ - Images with valid &#96;&lt;img&gt;&#96; sources are marked as capturable
+ - Page layout is not broken
+ - Page interactions work normally
+ - No console errors on common websites
+ 
+ - [ ] T045 [US3] Implement image detection in &#96;extension/content/content-script.ts&#96; (scan page for &#96;&lt;img&gt;&#96; elements with valid src attributes, filter out broken or invalid images, mark images as capturable)
+ - [ ] T046 [US3] Inject capture controls into page in &#96;extension/content/content-script.ts&#96; (add "Cap!" button overlay to capturable images, use isolated world to avoid page conflicts, style with Tailwind-like classes or inline styles)
+ - [ ] T047 [US3] Ensure content script uses isolated world in &#96;extension/manifest.json&#96; (verify content_scripts configuration uses isolated world, no unsafeWindow access)
+ - [ ] T048 [US3] Test image detection on common websites (e-commerce sites, social media, image galleries, verify no page layout breaks, verify no console errors)
+ - [ ] T049 [US3] Handle edge cases: pages with no images, broken images, lazy-loaded images (graceful handling, no errors, extension still functional)
+ 
+ **Checkpoint**: At this point, User Story 3 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 6: User Story 4 - Capture Image Using "Cap!" Button (Priority: P2)
+ 
+ **Goal**: Users can capture images by clicking "Cap!" and items appear in panel within 2 seconds.
+ 
+ **Independent Test**: Click "Cap!" on an image and verify it appears in the CapThat panel within 2 seconds with all required metadata, and duplicate captures are handled appropriately.
+ 
+ **Acceptance Criteria**:
+ - Item appears in panel within 2 seconds
+ - Item includes image reference (URL or blob), source page URL, captured timestamp
+ - Duplicate captures handled consistently (content hash matching)
+ - Warning shown at 80 items
+ - Capture blocked at 100 items with "Board is full" message
+ 
+ ### Capture Flow
+ 
+ - [ ] T050 [US4] Implement capture button click handler in &#96;extension/content/content-script.ts&#96; (listen for "Cap!" button clicks, extract image URL and source page URL, collect optional metadata, send CaptureRequestMessage to service worker)
+ - [ ] T051 [US4] Implement capture request handler in &#96;extension/background/service-worker.ts&#96; (receive CaptureRequestMessage, validate image URL and source URL, attempt image fetch with CORS fallback, create CapturedItem with unique ID, validate item via schema validator)
+ - [ ] T052 [US4] Implement image fetch with CORS fallback in &#96;extension/background/service-worker.ts&#96; (try fetch blob first, fallback to URL storage if CORS blocked, set qualityIndicator based on method used, handle fetch errors gracefully)
+ - [ ] T053 [US4] Create CapturedItem with metadata in &#96;extension/background/service-worker.ts&#96; (generate UUID v4 for id, create ImageReference with urlOrBlob, set sourceUrl, set timestamp to current time, extract optional metadata from page, set qualityIndicator)
+ - [ ] T054 [US4] Implement duplicate detection in &#96;extension/background/service-worker.ts&#96; (calculate content hash for image, check against existing items, prevent duplicate or mark as already captured, use image content hash not URL)
+ - [ ] T055 [US4] Check board size limits before capture in &#96;extension/background/service-worker.ts&#96; (check items.length &gt;= 80 for warning, check items.length &gt;= 100 for hard limit, return appropriate error messages, prevent capture at 100 items)
+ - [ ] T056 [US4] Save captured item to storage in &#96;extension/background/service-worker.ts&#96; (add item to CapBoard items array, save board via storage adapter, handle storage errors, send StorageUpdateMessage to UI)
+ - [ ] T057 [US4] Send capture response to content script in &#96;extension/background/service-worker.ts&#96; (send CaptureResponseMessage with success/failure, include itemId on success, include error and errorCategory on failure)
+ - [ ] T058 [US4] Display toast notification "Captured" in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (show toast when StorageUpdateMessage received with action 'add', non-blocking toast, auto-dismiss after 2 seconds)
+ - [ ] T059 [US4] Handle capture errors in content script in &#96;extension/content/content-script.ts&#96; (receive CaptureResponseMessage, show error toast with retry button if retryable, handle permission/CORS/storage/validation errors appropriately)
+ 
+ **Checkpoint**: At this point, User Story 4 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 7: User Story 5 - View Captured Items in Grid (Priority: P2)
+ 
+ **Goal**: Captured items render as thumbnails in grid slots and board state persists across sessions.
+ 
+ **Independent Test**: Capture multiple items and verify they render as thumbnails in grid slots with metadata, and the board state persists across refreshes and browser restarts.
+ 
+ **Acceptance Criteria**:
+ - Empty slots show placeholders when no items
+ - Captured items render as thumbnails in grid slots
+ - Grid cells show thumbnail and optional metadata (title/domain)
+ - Virtual scrolling works for 100+ items (fixed slots, content scrolls)
+ - Board state persists after panel close/reopen
+ - Board state persists after browser restart
+ 
+ ### Grid Display
+ 
+ - [ ] T060 [US5] Load board from storage on panel open in &#96;extension/ui/side-panel.tsx&#96; (call storage adapter loadBoard on component mount, handle null/empty board, set initial state)
+ - [ ] T061 [US5] Render captured items in ImageGrid in &#96;extension/ui/components/ImageGrid.tsx&#96; (map items array to grid slots, render ImageCard for each item, handle empty state with placeholders, display thumbnails from ImageReference)
+ - [ ] T062 [US5] Display thumbnails in ImageCard in &#96;extension/ui/components/ImageCard.tsx&#96; (render thumbnail from ImageReference.thumbnail or urlOrBlob, handle blob references, handle URL references, show fallback if image fails to load)
+ - [ ] T063 [US5] Display optional metadata in ImageCard in &#96;extension/ui/components/ImageCard.tsx&#96; (show title if available in metadata, show domain if available, style metadata with Tailwind)
+ - [ ] T064 [US5] Implement virtual scrolling in ImageGrid in &#96;extension/ui/components/ImageGrid.tsx&#96; (use virtual scrolling library or custom implementation, show fixed number of slots, scroll content within slots, handle 100+ items smoothly)
+ - [ ] T065 [US5] Listen for storage updates in &#96;extension/ui/side-panel.tsx&#96; (listen for StorageUpdateMessage from service worker, update UI when items added/removed/cleared, handle 'add' action to add item to grid, handle 'clear' action to clear grid)
+ - [ ] T066 [US5] Persist board state automatically in &#96;extension/background/service-worker.ts&#96; (save board to storage after any item add/remove/clear, use storage adapter, handle storage errors gracefully)
+ - [ ] T067 [US5] Test board persistence across sessions (capture items, close panel, reopen panel, verify items load, restart browser, reopen panel, verify items still present)
+ 
+ **Checkpoint**: At this point, User Story 5 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 8: User Story 6 - Remove a Captured Item (Priority: P3)
+ 
+ **Goal**: Users can remove individual items from the board without affecting other items.
+ 
+ **Independent Test**: Remove an individual item and verify it disappears immediately, is removed from storage, and other items remain intact.
+ 
+ **Acceptance Criteria**:
+ - Item disappears immediately from UI
+ - Item is removed from storage
+ - Other items remain on board
+ - No unintended side effects
+ 
+ - [ ] T068 [US6] Add remove control (X button) to ImageCard in &#96;extension/ui/components/ImageCard.tsx&#96; (add X button overlay on hover, style with Tailwind, keyboard accessible)
+ - [ ] T069 [US6] Implement remove button click handler in &#96;extension/ui/components/ImageCard.tsx&#96; (send BoardUpdateMessage with action 'remove' and itemId to service worker, handle click event)
+ - [ ] T070 [US6] Handle remove request in service worker in &#96;extension/background/service-worker.ts&#96; (receive BoardUpdateMessage with action 'remove', validate itemId, remove item from CapBoard items array, save updated board to storage, send StorageUpdateMessage with action 'remove' to UI)
+ - [ ] T071 [US6] Update UI on item removal in &#96;extension/ui/components/ImageGrid.tsx&#96; (listen for StorageUpdateMessage with action 'remove', remove item from grid display immediately, update grid state)
+ - [ ] T072 [US6] Verify item removed from storage (check chrome.storage.local after removal, verify item no longer in items array, verify other items intact)
+ 
+ **Checkpoint**: At this point, User Story 6 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 9: User Story 7 - Clear the Entire Cap Board (Priority: P3)
+ 
+ **Goal**: Users can clear the entire board with confirmation, removing all items from UI and storage.
+ 
+ **Independent Test**: Click "Clear Cap Board", confirm the action, and verify all items are removed from UI and storage.
+ 
+ **Acceptance Criteria**:
+ - Confirmation step appears (modal or confirm prompt)
+ - All items removed from UI after confirmation
+ - All items deleted from storage
+ - Board is empty
+ 
+ - [ ] T073 [US7] Implement clear button click handler in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (show confirmation modal or use confirm prompt, only blocking alert allowed, handle user confirmation/cancellation)
+ - [ ] T074 [US7] Create confirmation modal component in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (modal with "Clear Cap Board?" message, Confirm and Cancel buttons, styled with Tailwind, glassmorphism effects)
+ - [ ] T075 [US7] Handle clear request in service worker in &#96;extension/background/service-worker.ts&#96; (receive BoardUpdateMessage with action 'clear', clear items array from CapBoard, save empty board to storage, send StorageUpdateMessage with action 'clear' and empty board to UI)
+ - [ ] T076 [US7] Update UI on board clear in &#96;extension/ui/components/ImageGrid.tsx&#96; (listen for StorageUpdateMessage with action 'clear', clear all items from grid display, show empty state with placeholders)
+ - [ ] T077 [US7] Verify all items removed from storage (check chrome.storage.local after clear, verify items array is empty, verify board metadata still present)
+ 
+ **Checkpoint**: At this point, User Story 7 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 10: User Story 8 - Persist Board Using Extension Storage (Priority: P2)
+ 
+ **Goal**: Board automatically saves and loads, with graceful error handling for storage failures.
+ 
+ **Independent Test**: Capture items, close and reopen the panel, and verify items load automatically. Storage errors should be handled gracefully.
+ 
+ **Acceptance Criteria**:
+ - Board metadata persisted in chrome.storage.local
+ - Image blobs stored in IndexedDB (if applicable)
+ - Items load automatically when panel reopens
+ - Storage errors handled gracefully with non-blocking message
+ 
+ - [ ] T078 [US8] Auto-save board on changes in &#96;extension/background/service-worker.ts&#96; (save board to storage after every add/remove/clear operation, use storage adapter, handle save errors)
+ - [ ] T079 [US8] Auto-load board on panel open in &#96;extension/ui/side-panel.tsx&#96; (load board from storage on component mount, handle null/empty board, update UI state)
+ - [ ] T080 [US8] Handle storage load errors gracefully in &#96;extension/ui/side-panel.tsx&#96; (catch storage errors, show non-blocking error message, allow panel to function with empty board)
+ - [ ] T081 [US8] Handle storage save errors gracefully in &#96;extension/background/service-worker.ts&#96; (catch storage errors, send ErrorMessage to UI, allow user to retry, prevent data loss)
+ - [ ] T082 [US8] Test persistence across browser restarts (capture items, close browser, reopen browser, open panel, verify items load)
+ 
+ **Checkpoint**: At this point, User Story 8 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 11: User Story 9 - Export Board Metadata as JSON (Priority: P3)
+ 
+ **Goal**: Users can export board metadata as a valid JSON file with all required fields.
+ 
+ **Independent Test**: Click "Export JSON" and verify a valid JSON file downloads with all required metadata fields for each item.
+ 
+ **Acceptance Criteria**:
+ - &#96;.json&#96; file downloads
+ - JSON includes for each item: id, imageUrl (or filename reference), sourceUrl, timestamp, optional metadata fields
+ - JSON validates (no circular refs, valid UTF-8)
+ - Toast notification: "Exported successfully"
+ 
+ - [ ] T083 [US9] Implement JSON export logic in &#96;extension/export/json-export.ts&#96; (create ExportManifest with board metadata, map CapturedItem to ExportItemReference, serialize to JSON, validate JSON structure, handle circular references)
+ - [ ] T084 [US9] Handle export request in service worker in &#96;extension/background/service-worker.ts&#96; (receive ExportRequestMessage with format 'json', call JSON export function, create downloadable file, send ExportResponseMessage with filename)
+ - [ ] T085 [US9] Trigger file download in UI in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (receive ExportResponseMessage, create download link with blob URL, trigger download, show "Exported successfully" toast)
+ - [ ] T086 [US9] Sanitize JSON output in &#96;extension/export/json-export.ts&#96; (ensure valid UTF-8 encoding, remove circular references, validate JSON structure before serialization)
+ - [ ] T087 [US9] Test JSON export validation (export board, open JSON file, verify structure, verify all required fields present, verify no circular refs)
+ 
+ **Checkpoint**: At this point, User Story 9 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 12: User Story 10 - Export Individual Captured Images (Priority: P3)
+ 
+ **Goal**: Users can export each captured image as separate files with consistent, unique filenames.
+ 
+ **Independent Test**: Click "Export Individual Caps" and verify multiple image files download with consistent, unique filenames, and CORS-blocked images are handled appropriately.
+ 
+ **Acceptance Criteria**:
+ - Multiple image files download
+ - Filenames are consistent and unique (e.g., cap-&lt;timestamp&gt;-&lt;id&gt;.png)
+ - CORS-blocked images are skipped and reported in summary
+ - Export completes successfully
+ 
+ - [ ] T088 [US10] Implement filename sanitization in &#96;extension/export/filename-sanitizer.ts&#96; (remove path traversal characters: /, \, .., etc., limit filename length, ensure unique filenames with timestamp and ID, format: cap-&lt;timestamp&gt;-&lt;id&gt;.png)
+ - [ ] T089 [US10] Implement individual image export in &#96;extension/export/individual-export.ts&#96; (iterate through board items, attempt to download each image, handle CORS-blocked images, skip failed downloads, track skipped count)
+ - [ ] T090 [US10] Handle CORS-blocked images in export in &#96;extension/export/individual-export.ts&#96; (detect CORS errors, skip image, increment skippedCount, continue with next image)
+ - [ ] T091 [US10] Trigger multiple file downloads in UI in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (receive ExportResponseMessage, create download links for each image, trigger downloads sequentially or in batch, show skipped count in toast if applicable)
+ - [ ] T092 [US10] Report skipped images in export response in &#96;extension/background/service-worker.ts&#96; (include skippedCount in ExportResponseMessage, show summary message to user)
+ 
+ **Checkpoint**: At this point, User Story 10 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 13: User Story 11 - Export Full Cap Board as ZIP (Priority: P3)
+ 
+ **Goal**: Users can export the entire board as a single ZIP file containing images and board.json manifest.
+ 
+ **Independent Test**: Click "Export CapBoard" and verify a ZIP file downloads containing images folder and board.json manifest, completing successfully for boards up to 50 items.
+ 
+ **Acceptance Criteria**:
+ - Single &#96;.zip&#96; file downloads
+ - ZIP contains /images/ folder with images (if available)
+ - ZIP contains board.json manifest referencing those images
+ - Export completes without crashing
+ 
+ - [ ] T093 [US11] Install and configure JSZip dependency in &#96;package.json&#96; (add jszip package, configure for extension build)
+ - [ ] T094 [US11] Implement ZIP export logic in &#96;extension/export/zip-export.ts&#96; (create JSZip instance, add images to /images/ folder, create board.json manifest, generate ZIP blob, handle errors)
+ - [ ] T095 [US11] Create board.json manifest for ZIP in &#96;extension/export/zip-export.ts&#96; (create ExportManifest with board metadata, map items to ExportItemReference with filename mappings, serialize to JSON)
+ - [ ] T096 [US11] Handle ZIP export request in service worker in &#96;extension/background/service-worker.ts&#96; (receive ExportRequestMessage with format 'zip', call ZIP export function, create downloadable ZIP file, send ExportResponseMessage with filename)
+ - [ ] T097 [US11] Trigger ZIP file download in UI in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (receive ExportResponseMessage, create download link with ZIP blob URL, trigger download, show "Exported successfully" toast)
+ - [ ] T098 [US11] Test ZIP export with 50 items (capture 50 items, export ZIP, verify ZIP structure, verify images folder, verify board.json, verify no crashes)
+ 
+ **Checkpoint**: At this point, User Story 11 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 14: User Story 12 - Handle CORS-Blocked Images with Fallback (Priority: P2)
+ 
+ **Goal**: Extension captures images even when direct download fails, using fallback mechanisms.
+ 
+ **Independent Test**: Attempt to capture CORS-blocked images and verify fallback mechanisms work, items are still added to the board, and users are informed about fallback usage.
+ 
+ **Acceptance Criteria**:
+ - System tries capture in order: URL storage ‚Üí blob fetch ‚Üí fallback
+ - Item is added to board even when fallback used
+ - Item has usable thumbnail
+ - User is informed via badge/tooltip if lower-quality fallback used
+ 
+ - [ ] T099 [US12] Implement CORS fallback strategy in &#96;extension/background/service-worker.ts&#96; (try URL storage first, attempt blob fetch, fallback to URL-only storage if CORS blocked, set qualityIndicator based on method used)
+ - [ ] T100 [US12] Set qualityIndicator on CapturedItem in &#96;extension/background/service-worker.ts&#96; (set 'url-only' if URL storage used, set 'blob' if blob fetch succeeded, set 'fallback' if fallback method used)
+ - [ ] T101 [US12] Display fallback indicator in ImageCard in &#96;extension/ui/components/ImageCard.tsx&#96; (show badge or tooltip if qualityIndicator is 'url-only' or 'fallback', style with Tailwind, inform user of lower quality)
+ - [ ] T102 [US12] Ensure thumbnail available even with fallback in &#96;extension/background/service-worker.ts&#96; (generate thumbnail from image URL if blob unavailable, use data URL or base64 thumbnail, ensure thumbnail always present for grid display)
+ - [ ] T103 [US12] Test CORS fallback on various websites (test on sites with strict CORS, verify fallback works, verify items still captured, verify user informed of fallback)
+ 
+ **Checkpoint**: At this point, User Story 12 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 15: User Story 13 - Show Status Feedback for Actions (Priority: P3)
+ 
+ **Goal**: Users receive appropriate feedback (toasts/notifications) for all actions without blocking interaction.
+ 
+ **Independent Test**: Perform various actions (capture, export, clear) and verify appropriate feedback messages appear without blocking user interaction except for clear confirmation.
+ 
+ **Acceptance Criteria**:
+ - Capture shows "Captured" toast
+ - Export shows "Exported successfully" message
+ - Errors show toast with clear message and retry button
+ - Retry button allows retry of failed action
+ - Only "Clear board confirmation" shows blocking alert
+ 
+ - [ ] T104 [US13] Create toast notification component in &#96;extension/ui/components/Toast.tsx&#96; (toast component with message, auto-dismiss after 2-3 seconds, non-blocking, styled with Tailwind, glassmorphism effects)
+ - [ ] T105 [US13] Implement toast system in &#96;extension/ui/side-panel.tsx&#96; (toast state management, show/hide toasts, queue multiple toasts, position toasts appropriately)
+ - [ ] T106 [US13] Show "Captured" toast on successful capture in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (listen for StorageUpdateMessage with action 'add', show "Captured" toast)
+ - [ ] T107 [US13] Show "Exported successfully" toast on export success in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (listen for ExportResponseMessage with success=true, show "Exported successfully" toast)
+ - [ ] T108 [US13] Show error toast with retry button in &#96;extension/ui/components/Toast.tsx&#96; (error toast component with message, retry button, handle retry action, show error category, styled appropriately)
+ - [ ] T109 [US13] Implement retry functionality in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (store last failed action, retry on button click, resend request to service worker)
+ - [ ] T110 [US13] Ensure only clear confirmation is blocking in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (verify all toasts are non-blocking, only clear confirmation modal blocks interaction)
+ 
+ **Checkpoint**: At this point, User Story 13 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 16: User Story 14 - Send Captured Items to Local Next.js API (Priority: P4 - Optional Phase 2)
+ 
+ **Goal**: Extension can send captured items to local Next.js app when available, with graceful fallback.
+ 
+ **Independent Test**: Capture items and verify they are posted to the local Next.js API when available, with appropriate fallback behavior when the app is not running.
+ 
+ **Acceptance Criteria**:
+ - Items posted to http://localhost:3000/api/capture when app running
+ - Falls back to extension-only storage when app not running
+ - "Local app not detected" message shown when app unavailable (non-blocking)
+ - Extension functions normally regardless of app availability
+ 
+ ### Next.js API (Phase 2)
+ 
+ - [ ] T111 [US14] Create Next.js API route at &#96;app/api/capture/route.ts&#96; (POST handler, validate request origin is chrome-extension, validate payload structure, save item to Next.js storage, return success/error response)
+ - [ ] T112 [US14] Implement CORS handling in Next.js API in &#96;app/api/capture/route.ts&#96; (allow chrome-extension origins, validate origin, return appropriate CORS headers)
+ - [ ] T113 [US14] Validate capture payload in Next.js API in &#96;app/api/capture/route.ts&#96; (validate itemId, sourceUrl, timestamp, imageReference, metadata, return 400 if invalid)
+ - [ ] T114 [US14] Store captured items in Next.js app in &#96;app/api/capture/route.ts&#96; (save to database or file storage, handle storage errors, return 500 on server error)
+ 
+ ### Extension Integration
...
- ---
- 
- ## Implementation Strategy
- 
- ### MVP First (User Stories 1 &amp; 2 Only)
- 
- 1. Complete Phase 1: Setup
- 2. Complete Phase 2: Foundational (CRITICAL - blocks all stories)
- 3. Complete Phase 3: User Story 1 (Load Extension)
- 4. Complete Phase 4: User Story 2 (Show Panel UI)
- 5. **STOP and VALIDATE**: Test User Stories 1 and 2 independently
- 6. Deploy/demo if ready
+ - [ ] T115 [US14] Detect local Next.js app availability in &#96;extension/background/service-worker.ts&#96; (check if http://localhost:3000 is reachable, ping API endpoint, cache availability status)
+ - [ ] T116 [US14] Send captured items to Next.js API in &#96;extension/background/service-worker.ts&#96; (POST to http://localhost:3000/api/capture with capture payload, validate origin before sending, handle network errors)
+ - [ ] T117 [US14] Implement fallback to extension storage in &#96;extension/background/service-worker.ts&#96; (if API unavailable, save to extension storage only, if API request fails, save to extension storage, ensure no data loss)
+ - [ ] T118 [US14] Show "Local app not detected" message in &#96;extension/ui/components/CapBoardPanel.tsx&#96; (detect when app unavailable, show non-blocking message, allow extension to function normally)
+ - [ ] T119 [US14] Validate localhost origin in extension in &#96;extension/background/service-worker.ts&#96; (ensure requests only go to http://localhost:3000, reject other origins, security validation)
+ - [ ] T120 [US14] Test integration with Next.js app (start Next.js app, capture item, verify POST to /api/capture, stop app, capture item, verify fallback to extension storage)
+ 
+ **Checkpoint**: At this point, User Story 14 should be fully functional and testable independently
+ 
+ ---
+ 
+ ## Phase 17: Polish &amp; Cross-Cutting Concerns
...
- ### Incremental Delivery
+ **Purpose**: Improvements that affect multiple user stories
...
- 1. Complete Setup + Foundational ‚Üí Foundation ready
- 2. Add User Story 1 ‚Üí Test independently ‚Üí Deploy/Demo (Extension loads!)
- 3. Add User Story 2 ‚Üí Test independently ‚Üí Deploy/Demo (UI visible!)
- 4. Add User Story 3 ‚Üí Test independently ‚Üí Deploy/Demo (Image detection!)
- 5. Add User Story 4 ‚Üí Test independently ‚Üí Deploy/Demo (Capture works!)
- 6. Add User Story 5 ‚Üí Test independently ‚Üí Deploy/Demo (Grid display!)
- 7. Add User Story 8 ‚Üí Test independently ‚Üí Deploy/Demo (Persistence!)
- 8. Add User Story 12 ‚Üí Test independently ‚Üí Deploy/Demo (CORS handling!)
- 9. Add remaining stories ‚Üí Test independently ‚Üí Deploy/Demo
- 10. Each story adds value without breaking previous stories
- 
- ### Parallel Team Strategy
- 
- With multiple developers:
- 
- 1. Team completes Setup + Foundational together
- 2. Once Foundational is done:
-    - Developer A: User Story 1 (Load Extension)
-    - Developer B: User Story 2 (Panel UI)
-    - Developer C: User Story 3 (Image Detection)
- 3. After US1, US2, US3 complete:
-    - Developer A: User Story 4 (Capture)
-    - Developer B: User Story 8 (Persistence)
-    - Developer C: User Story 12 (CORS Fallback)
- 4. After US4, US5 complete:
-    - Developer A: User Story 6 (Remove Item)
-    - Developer B: User Story 7 (Clear Board)
-    - Developer C: User Story 9 (Export JSON)
- 5. Stories complete and integrate independently
- 
- ---
- 
- ## Task Summary
- 
- **Total Tasks**: 140
+ - [ ] T121 [P] Documentation updates in &#96;extension/README.md&#96; (usage instructions, build instructions, development setup)
+ - [ ] T122 [P] Code cleanup and refactoring (review all code, remove unused code, improve code organization)
+ - [ ] T123 [P] Performance optimization across all stories (optimize image loading, optimize storage operations, optimize UI rendering)
+ - [ ] T124 [P] Security hardening (review all security requirements, verify CSP compliance, verify input validation, verify filename sanitization)
+ - [ ] T125 Run quickstart.md validation (execute all test scenarios from quickstart.md, verify all acceptance criteria met, document any issues)
+ 
+ ---
+ 
+ ## Dependencies &amp; Execution Order
+ 
+ ### Phase Dependencies
+ 
+ - **Setup (Phase 1)**: No dependencies - can start immediately
+ - **Foundational (Phase 2)**: Depends on Setup completion - BLOCKS all user stories
+ - **User Stories (Phase 3-16)**: All depend on Foundational phase completion
+   - User stories can then proceed in parallel (if staffed)
+   - Or sequentially in priority order (P1 ‚Üí P2 ‚Üí P3 ‚Üí P4)
+ - **Polish (Phase 17)**: Depends on all desired user stories being complete
+ 
+ ### User Story Dependencies
+ 
+ - **User Story 1 (P1)**: Can start after Foundational (Phase 2) - No dependencies on other stories
+ - **User Story 2 (P1)**: Can start after Foundational (Phase 2) - No dependencies on other stories
+ - **User Story 3 (P2)**: Can start after Foundational (Phase 2) - No dependencies on other stories
+ - **User Story 4 (P2)**: Can start after Foundational (Phase 2) - Depends on US3 for image detection
+ - **User Story 5 (P2)**: Can start after Foundational (Phase 2) - Depends on US4 for captured items
+ - **User Story 6 (P3)**: Can start after Foundational (Phase 2) - Depends on US5 for viewing items
+ - **User Story 7 (P3)**: Can start after Foundational (Phase 2) - Depends on US5 for viewing items
+ - **User Story 8 (P2)**: Can start after Foundational (Phase 2) - Depends on US4 for captured items
+ - **User Story 9 (P3)**: Can start after Foundational (Phase 2) - Depends on US5 for board data
+ - **User Story 10 (P3)**: Can start after Foundational (Phase 2) - Depends on US5 for board data
+ - **User Story 11 (P3)**: Can start after Foundational (Phase 2) - Depends on US5 for board data
+ - **User Story 12 (P2)**: Can start after Foundational (Phase 2) - Depends on US4 for capture flow
+ - **User Story 13 (P3)**: Can start after Foundational (Phase 2) - Depends on US4, US9, US10, US11 for actions
+ - **User Story 14 (P4)**: Can start after Foundational (Phase 2) - Depends on US4 for capture flow, optional Phase 2
...
- **Tasks by Phase**:
- - Phase 1 (Setup): 14 tasks
- - Phase 2 (Foundational): 14 tasks
- - Phase 3 (US1): 5 tasks
- - Phase 4 (US2): 11 tasks
- - Phase 5 (US3): 6 tasks
- - Phase 6 (US4): 12 tasks
- - Phase 7 (US5): 7 tasks
- - Phase 8 (US6): 5 tasks
- - Phase 9 (US7): 6 tasks
- - Phase 10 (US8): 7 tasks
- - Phase 11 (US9): 6 tasks
- - Phase 12 (US10): 7 tasks
- - Phase 13 (US11): 8 tasks
- - Phase 14 (US12): 6 tasks
- - Phase 15 (US13): 7 tasks
- - Phase 16 (US14): 11 tasks
- - Phase 17 (Polish): 8 tasks
- 
- **Tasks by User Story**:
- - User Story 1: 5 tasks
- - User Story 2: 11 tasks
- - User Story 3: 6 tasks
- - User Story 4: 12 tasks
- - User Story 5: 7 tasks
- - User Story 6: 5 tasks
- - User Story 7: 6 tasks
- - User Story 8: 7 tasks
- - User Story 9: 6 tasks
- - User Story 10: 7 tasks
- - User Story 11: 8 tasks
- - User Story 12: 6 tasks
- - User Story 13: 7 tasks
- - User Story 14: 11 tasks
- 
- **Parallel Opportunities Identified**:
- - Phase 2: 14 tasks marked [P] can run in parallel
- - User Story 2: 5 component creation tasks can run in parallel
- - User Stories 1, 2, 3: Can start in parallel after Phase 2
- - User Stories 4, 8, 12: Can start in parallel after US2 and US3
- - User Stories 6, 7, 9, 10, 11: Can start in parallel after US5
- 
- **Independent Test Criteria**:
- - US1: Extension loads in Chrome, appears in extensions list
- - US2: Panel opens and displays complete UI
- - US3: Images detected without breaking page layout
- - US4: Capture works within 2 seconds with duplicate handling
- - US5: Items render in grid and persist across restarts
- - US6: Individual items can be removed
- - US7: Entire board can be cleared with confirmation
- - US8: Board persists and loads automatically
- - US9: JSON export generates valid file
- - US10: Individual images export with unique filenames
- - US11: ZIP export contains images and manifest
- - US12: CORS-blocked images handled with fallback
- - US13: Status feedback appears for all actions
- - US14: Items sent to Next.js API when available
- 
- **Suggested MVP Scope**: User Stories 1 and 2 (Load Extension + Show Panel UI) provide the foundation. For a functional MVP, add User Stories 3, 4, 5, 8, and 12 (Image Detection + Capture + Grid Display + Persistence + CORS Handling).
- 
- ---
- 
- ## Notes
- 
- - [P] tasks = different files, no dependencies
- - [Story] label maps task to specific user story for traceability
- - Each user story should be independently completable and testable
- - Commit after each task or logical group
- - Stop at any checkpoint to validate story independently
- - Avoid: vague tasks, same file conflicts, cross-story dependencies that break independence
- - All tasks follow strict checklist format: &#96;- [ ] [TaskID] [P?] [Story?] Description with file path&#96;
- 
+ ### Within Each User Story
+ 
+ - Models/types before services
+ - Services before UI components
+ - Core implementation before integration
+ - Story complete before moving to next priority
+ 
+ ### Parallel Opportunities
+ 
+ - All Setup tasks marked [P] can run in parallel
+ - All Foundational tasks marked [P] can run in parallel (within Phase 2)
+ - Once Foundational phase completes, user stories can start in parallel (if team capacity allows)
+ - Models/types within a story marked [P] can run in parallel
+ - Different user stories can be worked on in parallel by different team members
+ 
+ ---
+ 
+ ## Parallel Example: User Story 2
+ 
+ &#96;&#96;&#96;bash
+ # Launch all UI components for User Story 2 together:
+ Task: "Create Header component at extension/ui/components/Header.tsx"
+ Task: "Create ImageGrid component at extension/ui/components/ImageGrid.tsx"
+ Task: "Create ImageCard component at extension/ui/components/ImageCard.tsx"
+ Task: "Create CapBoardPanel component at extension/ui/components/CapBoardPanel.tsx"
+ Task: "Create ActionButton component at extension/ui/components/ActionButton.tsx"
+ &#96;&#96;&#96;
+ 
+ ---
+ 
+ ## Parallel Example: Phase 2 Foundational
+ 
+ &#96;&#96;&#96;bash
+ # Launch all foundational tasks together (all marked [P]):
+ Task: "Define TypeScript types at extension/types/index.ts"
+ Task: "Define shared types at shared/types/index.ts"
+ Task: "Implement chrome.storage.local adapter at extension/storage/storage-adapter.ts"
+ Task: "Implement IndexedDB adapter at extension/storage/indexeddb-adapter.ts"
+ Task: "Create storage interface/abstraction at extension/storage/storage-interface.ts"
+ Task: "Implement URL validator at extension/validation/url-validator.ts"
+ Task: "Implement image validator at extension/validation/image-validator.ts"
+ Task: "Implement schema validator at extension/validation/schema-validator.ts"
+ Task: "Define message types at extension/types/messages.ts"
+ &#96;&#96;&#96;
+ 
+ ---
+ 
+ ## Implementation Strategy
+ 
+ ### MVP First (User Stories 1 &amp; 2 Only)
+ 
+ 1. Complete Phase 1: Setup
+ 2. Complete Phase 2: Foundational (CRITICAL - blocks all stories)
+ 3. Complete Phase 3: User Story 1 (Load Extension)
+ 4. Complete Phase 4: User Story 2 (Show Panel UI)
+ 5. **STOP and VALIDATE**: Test User Stories 1 &amp; 2 independently
+ 6. Deploy/demo if ready
+ 
+ ### Incremental Delivery
+ 
+ 1. Complete Setup + Foundational ‚Üí Foundation ready
+ 2. Add User Stories 1 &amp; 2 ‚Üí Test independently ‚Üí Deploy/Demo (MVP!)
+ 3. Add User Story 3 ‚Üí Test independently ‚Üí Deploy/Demo
+ 4. Add User Story 4 ‚Üí Test independently ‚Üí Deploy/Demo
+ 5. Add User Story 5 ‚Üí Test independently ‚Üí Deploy/Demo
+ 6. Add User Stories 6-8 ‚Üí Test independently ‚Üí Deploy/Demo
+ 7. Add User Stories 9-13 ‚Üí Test independently ‚Üí Deploy/Demo
+ 8. Add User Story 14 (optional Phase 2) ‚Üí Test independently ‚Üí Deploy/Demo
+ 9. Each story adds value without breaking previous stories
+ 
+ ### Parallel Team Strategy
+ 
+ With multiple developers:
+ 
+ 1. Team completes Setup + Foundational together
+ 2. Once Foundational is done:
+    - Developer A: User Stories 1 &amp; 2 (MVP)
+    - Developer B: User Story 3 (Image Detection)
+    - Developer C: User Story 4 (Capture)
+ 3. After MVP complete:
+    - Developer A: User Story 5 (View Grid)
+    - Developer B: User Story 8 (Persistence)
+    - Developer C: User Story 12 (CORS Fallback)
+ 4. After P2 stories complete:
+    - Developer A: User Stories 6 &amp; 7 (Remove/Clear)
+    - Developer B: User Stories 9-11 (Exports)
+    - Developer C: User Story 13 (Status Feedback)
+ 5. Stories complete and integrate independently
+ 
+ ---
+ 
+ ## Notes
+ 
+ - [P] tasks = different files, no dependencies
+ - [Story] label maps task to specific user story for traceability
+ - Each user story should be independently completable and testable
+ - Verify tests fail before implementing (if tests requested)
+ - Commit after each task or logical group
+ - Stop at any checkpoint to validate story independently
+ - Avoid: vague tasks, same file conflicts, cross-story dependencies that break independence
+ - All file paths must be exact and match project structure from plan.md
+ 
+ ---
+ 
+ ## Task Summary
+ 
+ **Total Tasks**: 125
+ 
+ **Tasks by Phase**:
+ - Phase 1 (Setup): 14 tasks
+ - Phase 2 (Foundational): 14 tasks
+ - Phase 3 (US1): 5 tasks
+ - Phase 4 (US2): 11 tasks
+ - Phase 5 (US3): 5 tasks
+ - Phase 6 (US4): 10 tasks
+ - Phase 7 (US5): 8 tasks
+ - Phase 8 (US6): 5 tasks
+ - Phase 9 (US7): 5 tasks
+ - Phase 10 (US8): 5 tasks
+ - Phase 11 (US9): 5 tasks
+ - Phase 12 (US10): 5 tasks
+ - Phase 13 (US11): 6 tasks
+ - Phase 14 (US12): 5 tasks
+ - Phase 15 (US13): 7 tasks
+ - Phase 16 (US14): 10 tasks
+ - Phase 17 (Polish): 5 tasks
+ 
+ **Tasks by User Story**:
+ - User Story 1: 5 tasks
+ - User Story 2: 11 tasks
+ - User Story 3: 5 tasks
+ - User Story 4: 10 tasks
+ - User Story 5: 8 tasks
+ - User Story 6: 5 tasks
+ - User Story 7: 5 tasks
+ - User Story 8: 5 tasks
+ - User Story 9: 5 tasks
+ - User Story 10: 5 tasks
+ - User Story 11: 6 tasks
+ - User Story 12: 5 tasks
+ - User Story 13: 7 tasks
+ - User Story 14: 10 tasks
+ 
+ **Parallel Opportunities Identified**:
+ - Phase 2: 14 tasks can run in parallel
+ - Phase 4: 5 component tasks can run in parallel
+ - Multiple user stories can be worked on in parallel after foundational phase
+ 
+ **Suggested MVP Scope**: User Stories 1 &amp; 2 (Load Extension + Show Panel UI) - 16 tasks total
+ 
+ **Independent Test Criteria**:
+ - Each user story has clear independent test criteria defined
+ - All stories can be tested independently without dependencies on other stories
+ - Test scenarios available in quickstart.md
+ 
```

</details>

</tool-use>

---



---


Checking for linting errors:


---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** ‚Ä¢ Read lints for 1 file</summary>
      
Lint paths:

- `specs/001-capthat-extension/tasks.md`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Regenerated `tasks.md` for the CapThat Chrome Extension. Summary:

## Summary

**Generated File**: `specs/001-capthat-extension/tasks.md`

**Total Tasks**: 125 tasks organized across 17 phases

**Task Breakdown**:
- **Phase 1 (Setup)**: 14 tasks - Project initialization and build pipeline
- **Phase 2 (Foundational)**: 14 tasks - Core infrastructure (BLOCKS all user stories)
- **Phases 3-16**: User stories in priority order (P1 ‚Üí P2 ‚Üí P3 ‚Üí P4)
  - US1 (P1): 5 tasks - Load Extension
  - US2 (P1): 11 tasks - Show Panel UI
  - US3 (P2): 5 tasks - Detect Images
  - US4 (P2): 10 tasks - Capture Image
  - US5 (P2): 8 tasks - View Grid
  - US6-14: 47 tasks - Additional features
- **Phase 17 (Polish)**: 5 tasks - Cross-cutting concerns

**Format Validation**: All tasks follow the strict checklist format:
- `- [ ] [TaskID] [P?] [Story?] Description with file path`
- Task IDs are sequential (T001-T125)
- Parallel tasks marked with [P]
- User story tasks labeled with [US1], [US2], etc.
- All tasks include exact file paths

**Key Features**:
- Tasks organized by user story for independent implementation
- Clear dependencies and execution order
- Parallel execution examples provided
- MVP scope identified (User Stories 1 & 2)
- Independent test criteria for each story
- All design documents mapped to tasks (plan.md, spec.md, data-model.md, contracts/, research.md)

The tasks.md file is ready for implementation. Each task is specific enough that an LLM can complete it without additional context.

---

_**User (2025-12-18 11:25Z)**_



---

_**Agent (model default, mode Agent)**_



---

