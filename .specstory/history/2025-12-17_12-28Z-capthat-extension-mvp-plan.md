<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 8052603c-bcd4-4506-989d-9611aa52d064 (2025-12-17 12:28Z) -->

# CapThat extension MVP plan (2025-12-17 12:28Z)

_**User (2025-12-17 02:58Z)**_

/speckit.plan 

Project: CapThat — Image Capture & Mood Board (Chrome Extension MV3 + Next.js Web App)

Goal:

Plan and scaffold a production-quality MVP for CapThat: a Chrome extension that lets users capture images from web pages (“Cap!”) and organize them into a Cap Board with export options. Optional Phase 2 adds local-only communication to a Next.js app running on localhost.

Tech Stack:

- Next.js (App Router) + React (functional components)

- Tailwind CSS only (no external UI libraries)

- Chrome Extension Manifest V3 (content scripts + service worker)

- Persistence: chrome.storage.local (metadata) + IndexedDB (image blobs, if used)

- Exports: JSON + ZIP via JSZip (and/or downloads API)

UI DESIGN REQUIREMENTS (MUST FOLLOW)

Context:

- Chrome extension + web app used to capture images from websites and arrange them into a mood-board.

- UI must feel clean, modern, futuristic, slightly sci-fi (not playful/cartoonish).

- Audience: designers, engineers, power users.

Visual style:

- Dark mode by default

- Glassmorphism / soft translucency panels

- Subtle gradients (teal/cyan/electric blue accents)

- Soft glows + ambient shadows

- Rounded corners, thin borders

- Low-contrast grid background

- Minimal text; strong visual hierarchy

Layout requirements: (Refere the attached image)

- Top browser-like header with URL bar and subtle navigation arrows

- Main content: grid of image cards (capturable items)

  - Each card includes a floating “Cap!” action button

- Right-side floating panel:

  - Title “CapThat!”

  - Cap Board grid (captured items)

  - Action buttons:

    - Clear Cap Board

    - Export JSON

    - Export CapBoard

    - Export Individual Caps

- Modular component structure required

Interaction details:

- Hover states (subtle glow and/or scale)

- Button press micro-interactions

- Smooth transitions (200–300ms)

- Cards lift slightly on hover

Accessibility & quality:

- High contrast text on dark background

- Keyboard navigable buttons

- Clean Tailwind class usage

- No lorem ipsum placeholders

Product Decisions (LOCKED):

- Duplicate detection: Exact URL string match (case-sensitive)

- Board limit: 100 items (warning at 80; hard stop at 100)

- Overflow behavior: Infinite vertical scroll

- Empty slots: Placeholder with “Empty” text/icon

- Capture failure UX: Toast notification with retry option

Scope:

- Local-first MVP (no auth, no cloud storage)

- Chrome-only support

- Desktop-first experience

- Image capture strategy: start with URL capture + best-effort fetch to blob; document CORS limitations and optional fallback (tab capture) for later

SECURITY REQUIREMENTS (INCORPORATE INTO MAIN SPEC + PLAN)

You must integrate the following into the main spec as non-functional requirements + acceptance criteria, and also keep a detailed checklist at:

specs/001-capthat-extension/checklists/security.md

1) Manifest Permissions (Least Privilege)

- Request minimal permissions (prefer activeTab over broad host permissions).

- Avoid *://*/* unless truly required; justify each permission in the spec.

2) Content Security Policy (CSP)

- Block eval() and inline scripts.

- Restrict script sources to extension scripts only.

- Control image sources to allow only: data:, blob:, https:, http: (as needed).

- Use strict CSP to reduce XSS risk.

3) Content Script Injection Safety

- Use isolated world (default MV3).

- Avoid direct access to page context.

- Sanitize any DOM injection/modification.

- Use secure message passing (validate message shapes, sender expectations).

4) Data Storage Security

- Validate all data before storage.

- Sanitize URLs (block javascript: and other dangerous schemes).

- Monitor storage quota; prevent DoS.

- Enforce the 100-item hard limit (security + UX).

5) Image Content Security

- Validate image URLs and MIME types.

- Implement size limits to prevent memory exhaustion.

- Use SHA-256 content hashing (at least as a Phase 1.5/2 item if not MVP).

- Handle malicious/corrupted images gracefully (fail-safe).

6) Export Security

- Sanitize filenames to prevent path traversal.

- Validate JSON structure/schema before export.

- Limit ZIP size and number of files.

- Use safe MIME types.

7) Input Validation (Everywhere)

- Validate URLs, metadata, timestamps on ingest AND on retrieval/render.

- Sanitize user-visible strings to prevent injection.

8) Error Handling

- Do not expose internal paths or storage structure in user-facing errors.

- Provide friendly messages + retry.

- Log detailed errors only in extension logs.

9) Data Privacy

- Store locally only; minimize data collected.

- No third-party sharing/analytics.

- Clear data on uninstall (or document the exact behavior and how it’s verified).

10) Local API Communication (Phase 2)

- Only communicate with http://localhost:3000 (no other hosts).

- Validate API responses; timeouts; handle failures gracefully.

- If local app not running, fall back to extension-only storage.

What to produce (Deliverables):

1) Updated high-level architecture overview

   - Extension components: manifest, content script, service worker, UI surface (popup/side panel/overlay)

   - Next.js app structure (optional Phase 2)

   - Data flow: page → content script → background → UI → storage → export

   - Security boundaries: isolated world, CSP, permission rationale, validation checkpoints

2) Folder and file structure (explicit)

   - extension/: manifest, service worker, content scripts, UI pages

   - web/: Next.js app routes, components, styles

   - shared/: types, validators, storage adapters, export utilities

   - specs/: main spec + security checklist linkage

3) Main spec integration plan

   - Identify which security requirements MUST appear in the main spec (non-functional reqs + AC)

   - Keep threat model/testing checklist in security.md

   - Provide a “Security Requirements” section outline for the main spec

   - Provide a “UI/Design Requirements” section outline for the main spec

4) Milestones (MVP v1, v1.5, v2)

   - MVP v1 (must-have): capture URL + metadata, board UI, persistence, exports, toasts, 80/100 limit, strict validation/CSP/permissions, futuristic UI

   - v1.5: improved robustness, MIME/size enforcement, better capture/dedupe messaging, export hardening, basic hashing if feasible

   - v2: local Next.js API integration, optional tab-capture fallback, cloud storage later (out of scope)

5) Step-by-step implementation plan (ordered)

   - Setup/build pipeline for extension + Next.js

   - Build futuristic Tailwind UI components (Header, ImageGrid, ImageCard, CapBoardPanel, ActionButton)

   - Implement content script injection safely

   - Implement message contracts + schema validation

   - Implement storage layer + quota monitoring + 80/100 limit enforcement

   - Implement infinite scroll + empty state placeholders

   - Implement exports (JSON + ZIP) with limits + filename sanitization

   - Implement error handling (toast + retry) + logging guidance

   - Add Phase 2 localhost-only API (optional)

6) Risks & mitigations (include security + reliability)

   - CORS limitations

   - Storage limits / DoS

   - XSS vectors via metadata/DOM

   - Over-broad permissions

   - Export path traversal / ZIP bombs

   - Performance at 100 items (virtualization optional)

Constraints:

- Do NOT write full code yet (this is a plan/spec step)

- Do NOT introduce external UI libraries

- Keep plan concise but engineering-focused

- Use clear headings and bullet points

- Include acceptance criteria highlights where relevant

Output format:

- Structured Markdown with clear sections

- Actionable steps an engineer can execute

- Explicit callouts: “Spec update required” vs “Checklist-only”

After the plan:

Also provide (separately) the initial UI implementation deliverable:

- JSX for the main page layout

- Reusable components with Tailwind classes in JSX:

  - Header

  - ImageGrid

  - ImageCard

  - CapBoardPanel

  - ActionButton

(Keep the code minimal and focused on layout/styling; no backend/cloud logic.)



--- Cursor Command: speckit.plan.md ---
---
description: Execute the implementation planning workflow using the plan template to generate design artifacts.
handoffs: 
  - label: Create Tasks
    agent: speckit.tasks
    prompt: Break the plan into tasks
    send: true
  - label: Create Checklist
    agent: speckit.checklist
    prompt: Create a checklist for the following domain...
---

## User Input

```text
$ARGUMENTS
```

You **MUST** consider the user input before proceeding (if not empty).

## Outline

1. **Setup**: Run `.specify/scripts/bash/setup-plan.sh --json` from repo root and parse JSON for FEATURE_SPEC, IMPL_PLAN, SPECS_DIR, BRANCH. For single quotes in args like "I'm Groot", use escape syntax: e.g 'I'\''m Groot' (or double-quote if possible: "I'm Groot").

2. **Load context**: Read FEATURE_SPEC and `.specify/memory/constitution.md`. Load IMPL_PLAN template (already copied).

3. **Execute plan workflow**: Follow the structure in IMPL_PLAN template to:
   - Fill Technical Context (mark unknowns as "NEEDS CLARIFICATION")
   - Fill Constitution Check section from constitution
   - Evaluate gates (ERROR if violations unjustified)
   - Phase 0: Generate research.md (resolve all NEEDS CLARIFICATION)
   - Phase 1: Generate data-model.md, contracts/, quickstart.md
   - Phase 1: Update agent context by running the agent script
   - Re-evaluate Constitution Check post-design

4. **Stop and report**: Command ends after Phase 2 planning. Report branch, IMPL_PLAN path, and generated artifacts.

## Phases

### Phase 0: Outline & Research

1. **Extract unknowns from Technical Context** above:
   - For each NEEDS CLARIFICATION → research task
   - For each dependency → best practices task
   - For each integration → patterns task

2. **Generate and dispatch research agents**:

   ```text
   For each unknown in Technical Context:
     Task: "Research {unknown} for {feature context}"
   For each technology choice:
     Task: "Find best practices for {tech} in {domain}"
   ```

3. **Consolidate findings** in `research.md` using format:
   - Decision: [what was chosen]
   - Rationale: [why chosen]
   - Alternatives considered: [what else evaluated]

**Output**: research.md with all NEEDS CLARIFICATION resolved

### Phase 1: Design & Contracts

**Prerequisites:** `research.md` complete

1. **Extract entities from feature spec** → `data-model.md`:
   - Entity name, fields, relationships
   - Validation rules from requirements
   - State transitions if applicable

2. **Generate API contracts** from functional requirements:
   - For each user action → endpoint
   - Use standard REST/GraphQL patterns
   - Output OpenAPI/GraphQL schema to `/contracts/`

3. **Agent context update**:
   - Run `.specify/scripts/bash/update-agent-context.sh cursor-agent`
   - These scripts detect which AI agent is in use
   - Update the appropriate agent-specific context file
   - Add only new technology from current plan
   - Preserve manual additions between markers

**Output**: data-model.md, /contracts/*, quickstart.md, agent-specific file

## Key rules

- Use absolute paths
- ERROR on gate failures or unresolved clarifications

--- End Command ---

---

_**Agent (model default, mode Agent)**_



---


Setting up the planning workflow. Running the setup script to get configuration.


---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **run_terminal_cmd** • Run command: cd c:\dev\capthat\cap-that && bash .specify/scripts/bash/setup-plan.sh --json</summary>

```bash
cd c:\dev\capthat\cap-that && bash .specify/scripts/bash/setup-plan.sh --json
```

```
At C:\Users\maadh\AppData\Local\Temp\ps-script-dde712bc-3191-46f2-af20-2518bf6d711a.ps1:7 char:28
+ cd c:\dev\capthat\cap-that &amp;&amp; bash .specify/scripts/bash/setup-plan.s ...
+                            ~~
The token '&amp;&amp;' is not a valid statement separator in this version.
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
    + FullyQualifiedErrorId : InvalidEndOfLine
 

```
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: specs/001-capthat-extension/spec.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: specs/001-capthat-extension/checklists/security.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: specs/001-capthat-extension/checklists/requirements.md</summary>

</details>
</tool-use>

---



---


Checking the project structure and locating the planning scripts:


---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** • Searched codebase "**/.specify/**/*" • **0** result in **1** directory</summary>

Directory: **c:\dev\capthat\cap-that** (0 file)

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** • Searched codebase "**/*plan*.md" • **0** result in **1** directory</summary>

Directory: **c:\dev\capthat\cap-that** (0 file)

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** • Searched codebase "**/*constitution*.md" • **0** result in **1** directory</summary>

Directory: **c:\dev\capthat\cap-that** (0 file)

</details>
</tool-use>

---



---


Creating the planning structure and generating the implementation plan. Starting with the architecture overview and plan document:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: package.json</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: app/page.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: app/layout.tsx</summary>

</details>
</tool-use>

---



---


Creating the implementation plan structure and documents:


---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** • Edit file: specs/001-capthat-extension/implementation-plan.md</summary>

**Chunk 1**
Lines added: 763, lines removed: 1

```diff
@@ -1,1 +1,763 @@
- 
+ # Implementation Plan: CapThat Chrome Extension
+ 
+ **Feature Branch**: &#96;001-capthat-extension&#96;  
+ **Created**: 2025-01-27  
+ **Status**: Planning  
+ **Feature Spec**: [spec.md](./spec.md)  
+ **Security Checklist**: [checklists/security.md](./checklists/security.md)
+ 
+ ## Executive Summary
+ 
+ This plan outlines the implementation of CapThat: a Chrome Extension (MV3) + Next.js web app for capturing and organizing images into a mood board. The MVP focuses on local-first functionality with a futuristic, dark-mode UI using Tailwind CSS only.
+ 
+ **Key Deliverables**:
+ - Chrome Extension with content script injection
+ - CapThat panel UI (side panel or overlay)
+ - Image capture with CORS fallback handling
+ - Board persistence (chrome.storage.local + IndexedDB)
+ - Export functionality (JSON + ZIP)
+ - Optional Phase 2: Local Next.js API integration
+ 
+ ---
+ 
+ ## 1. High-Level Architecture Overview
+ 
+ ### 1.1 Extension Components
+ 
+ #### **Manifest V3 Structure**
+ &#96;&#96;&#96;
+ manifest.json
+ ├── Permissions (minimal)
+ │   ├── storage (chrome.storage.local)
+ │   ├── activeTab (current tab access)
+ │   ├── scripting (content script injection)
+ │   └── sidePanel (optional, for panel UI)
+ ├── Content Security Policy (strict)
+ │   ├── script-src 'self'
+ │   ├── img-src 'self' data: blob: https: http:
+ │   └── connect-src 'self' http://localhost:3000
+ └── Background Service Worker
+     ├── Message routing
+     ├── Storage management
+     └── Export orchestration
+ &#96;&#96;&#96;
+ 
+ #### **Content Script**
+ - **Isolation**: MV3 isolated world (default)
+ - **Purpose**: Detect images, inject "Cap!" buttons
+ - **Communication**: &#96;postMessage&#96; to service worker
+ - **Security**: No direct page context access, sanitized DOM manipulation
+ 
+ #### **Service Worker (Background)**
+ - **Purpose**: Message handling, storage operations, export generation
+ - **Lifecycle**: Event-driven, persistent state via chrome.storage
+ - **Security**: Validates all messages, enforces storage limits
+ 
+ #### **UI Surface Options**
+ 1. **Side Panel** (recommended for MVP)
+    - Native Chrome UI
+    - Persistent across tabs
+    - Requires &#96;sidePanel&#96; permission
+ 2. **Action Popup** (alternative)
+    - Lightweight, quick access
+    - Closes on navigation
+ 3. **Injected Overlay** (fallback)
+    - Works without side panel permission
+    - More complex CSS isolation
+ 
+ **Decision**: Start with **Side Panel** for better UX; fallback to popup if needed.
+ 
+ ### 1.2 Next.js App Structure (Phase 2)
+ 
+ &#96;&#96;&#96;
+ app/
+ ├── api/
+ │   └── capture/
+ │       └── route.ts (POST handler)
+ ├── board/
+ │   └── page.tsx (board view)
+ └── layout.tsx (shared layout)
+ &#96;&#96;&#96;
+ 
+ **API Endpoint**: &#96;POST /api/capture&#96;
+ - Accepts: &#96;{ id, imageUrl, sourceUrl, timestamp, metadata }&#96;
+ - Validates payload structure
+ - Stores in local database (Phase 2)
+ - Returns: &#96;{ success: boolean, id?: string }&#96;
+ 
+ ### 1.3 Data Flow
+ 
+ &#96;&#96;&#96;
+ ┌─────────────┐
+ │ Web Page    │
+ │ (Images)    │
+ └──────┬──────┘
+        │
+        ▼
+ ┌─────────────────┐
+ │ Content Script  │ ◄─── Detects images, injects "Cap!" buttons
+ │ (Isolated)      │
+ └──────┬──────────┘
+        │ postMessage
+        ▼
+ ┌─────────────────┐
+ │ Service Worker  │ ◄─── Validates, processes capture
+ │ (Background)    │
+ └──────┬──────────┘
+        │
+        ├──► chrome.storage.local (metadata)
+        ├──► IndexedDB (image blobs)
+        └──► Side Panel UI (updates via storage events)
+ &#96;&#96;&#96;
+ 
+ **Export Flow**:
+ &#96;&#96;&#96;
+ Service Worker
+   ├──► Generate JSON manifest
+   ├──► Fetch images (with CORS handling)
+   ├──► Create ZIP via JSZip
+   └──► Download via chrome.downloads API
+ &#96;&#96;&#96;
+ 
+ ### 1.4 Security Boundaries
+ 
+ #### **Isolation Layers**
+ 1. **Content Script ↔ Page**: Isolated world, no &#96;unsafeWindow&#96;
+ 2. **Content Script ↔ Extension**: &#96;postMessage&#96; with validation
+ 3. **Extension ↔ Storage**: Input validation before write
+ 4. **Extension ↔ Export**: Filename sanitization, size limits
+ 
+ #### **Validation Checkpoints**
+ - **Input**: URLs, metadata, timestamps (on capture)
+ - **Storage**: Data schema validation (on write/read)
+ - **Export**: Filename sanitization, JSON structure validation
+ - **API** (Phase 2): Payload validation, localhost-only origin check
+ 
+ #### **Permission Rationale**
+ | Permission | Justification | Alternative Considered |
+ |------------|---------------|----------------------|
+ | &#96;storage&#96; | Required for chrome.storage.local | None |
+ | &#96;activeTab&#96; | Access current tab for image detection | &#96;*://*/*&#96; (too broad) |
+ | &#96;scripting&#96; | MV3 requirement for content script injection | None |
+ | &#96;sidePanel&#96; | Better UX than popup | Popup (acceptable fallback) |
+ 
+ ---
+ 
+ ## 2. Folder and File Structure
+ 
+ &#96;&#96;&#96;
+ cap-that/
+ ├── extension/                          # Chrome Extension
+ │   ├── manifest.json                   # MV3 manifest
+ │   ├── background/
+ │   │   └── service-worker.ts          # Background service worker
+ │   ├── content/
+ │   │   └── content-script.ts          # Content script injection
+ │   ├── ui/
+ │   │   ├── side-panel.html            # Side panel HTML
+ │   │   ├── side-panel.tsx             # React component
+ │   │   └── components/                # UI components
+ │   │       ├── Header.tsx
+ │   │       ├── ImageGrid.tsx
+ │   │       ├── ImageCard.tsx
+ │   │       ├── CapBoardPanel.tsx
+ │   │       └── ActionButton.tsx
+ │   ├── storage/
+ │   │   ├── storage-adapter.ts          # chrome.storage wrapper
+ │   │   └── indexeddb-adapter.ts       # IndexedDB wrapper
+ │   ├── export/
+ │   │   ├── json-export.ts              # JSON export logic
+ │   │   ├── zip-export.ts               # ZIP export logic
+ │   │   └── filename-sanitizer.ts       # Filename sanitization
+ │   ├── validation/
+ │   │   ├── url-validator.ts            # URL validation
+ │   │   ├── image-validator.ts          # Image validation
+ │   │   └── schema-validator.ts         # Data schema validation
+ │   └── types/
+ │       └── index.ts                    # TypeScript types
+ │
+ ├── web/                                # Next.js App (Phase 2)
+ │   ├── app/
+ │   │   ├── api/
+ │   │   │   └── capture/
+ │   │   │       └── route.ts            # POST /api/capture
+ │   │   ├── board/
+ │   │   │   └── page.tsx                # Board view page
+ │   │   └── layout.tsx                  # Root layout
+ │   └── components/                     # Shared components
+ │
+ ├── shared/                             # Shared code
+ │   ├── types/
+ │   │   └── index.ts                    # Shared TypeScript types
+ │   ├── validators/
+ │   │   ├── url.ts                      # URL validation
+ │   │   ├── image.ts                    # Image validation
+ │   │   └── schema.ts                   # Schema validation
+ │   ├── storage/
+ │   │   └── adapters.ts                 # Storage interface
+ │   └── export/
+ │       ├── json.ts                     # JSON export utilities
+ │       └── zip.ts                      # ZIP export utilities
+ │
+ ├── specs/
+ │   └── 001-capthat-extension/
+ │       ├── spec.md                     # Main feature spec
+ │       ├── implementation-plan.md      # This document
+ │       └── checklists/
+ │           ├── requirements.md
+ │           └── security.md
+ │
+ └── build/                              # Build output
+     ├── extension/                      # Packed extension
+     └── web/                            # Next.js build
+ &#96;&#96;&#96;
+ 
+ **Build Configuration**:
+ - **Extension**: TypeScript + Vite (or esbuild) for bundling
+ - **Web**: Next.js default build (&#96;next build&#96;)
+ - **Shared**: Compiled to both extension and web targets
+ 
+ ---
+ 
+ ## 3. Main Spec Integration Plan
+ 
+ ### 3.1 Security Requirements Integration
+ 
+ **Location in Main Spec**: Add new section "Security Requirements" after "Functional Requirements"
+ 
+ **Structure**:
+ &#96;&#96;&#96;markdown
+ ## Security Requirements
+ 
+ ### Non-Functional Requirements
+ - **NFR-SEC-001**: Extension MUST request minimal permissions (activeTab over *://*/*)
+ - **NFR-SEC-002**: Extension MUST implement strict CSP (no eval, no inline scripts)
+ - **NFR-SEC-003**: Content scripts MUST use isolated world (no unsafeWindow)
+ - **NFR-SEC-004**: All inputs MUST be validated before storage
+ - **NFR-SEC-005**: URLs MUST be sanitized (block javascript: schemes)
+ - **NFR-SEC-006**: Storage quota MUST be monitored (prevent DoS)
+ - **NFR-SEC-007**: Image size MUST be limited (prevent memory exhaustion)
+ - **NFR-SEC-008**: Export filenames MUST be sanitized (prevent path traversal)
+ - **NFR-SEC-009**: Error messages MUST NOT expose internal paths
+ - **NFR-SEC-010**: Phase 2 API MUST only communicate with localhost:3000
+ 
+ ### Acceptance Criteria
+ - [AC-SEC-001] Manifest permissions reviewed and justified
+ - [AC-SEC-002] CSP violations blocked in testing
+ - [AC-SEC-003] XSS prevention verified in content scripts
+ - [AC-SEC-004] Input validation tested with malicious URLs
+ - [AC-SEC-005] Storage quota handling tested
+ - [AC-SEC-006] Export filename sanitization verified
+ &#96;&#96;&#96;
+ 
+ **Action**: Update &#96;spec.md&#96; with above section (Spec update required)
+ 
+ ### 3.2 UI/Design Requirements Integration
+ 
+ **Location in Main Spec**: Add new section "UI/Design Requirements" after "Assumptions"
+ 
+ **Structure**:
+ &#96;&#96;&#96;markdown
+ ## UI/Design Requirements
+ 
+ ### Visual Style
+ - **UI-001**: Dark mode by default
+ - **UI-002**: Glassmorphism / soft translucency panels
+ - **UI-003**: Subtle gradients (teal/cyan/electric blue accents)
+ - **UI-004**: Soft glows + ambient shadows
+ - **UI-005**: Rounded corners, thin borders
+ - **UI-006**: Low-contrast grid background
+ - **UI-007**: Minimal text; strong visual hierarchy
+ 
+ ### Layout Requirements
+ - **UI-008**: Top browser-like header with URL bar and navigation arrows
+ - **UI-009**: Main content: grid of image cards with floating "Cap!" buttons
+ - **UI-010**: Right-side floating panel: "CapThat!" title, board grid, action buttons
+ - **UI-011**: Modular component structure (Header, ImageGrid, ImageCard, CapBoardPanel, ActionButton)
+ 
+ ### Interaction Requirements
+ - **UI-012**: Hover states (subtle glow and/or scale)
+ - **UI-013**: Button press micro-interactions
+ - **UI-014**: Smooth transitions (200–300ms)
+ - **UI-015**: Cards lift slightly on hover
+ 
+ ### Accessibility Requirements
+ - **UI-016**: High contrast text on dark background
+ - **UI-017**: Keyboard navigable buttons
+ - **UI-018**: Clean Tailwind class usage (no external UI libraries)
+ &#96;&#96;&#96;
+ 
+ **Action**: Update &#96;spec.md&#96; with above section (Spec update required)
+ 
+ ### 3.3 Security Checklist Linkage
+ 
+ **Location**: &#96;checklists/security.md&#96; (already exists)
+ 
+ **Action**: Keep detailed threat model and testing checklist in &#96;security.md&#96; (Checklist-only)
+ 
+ **Integration Points**:
+ - Main spec references security checklist for detailed testing
+ - Implementation plan references security checklist for validation checkpoints
+ - Code reviews use security checklist as validation guide
+ 
+ ---
+ 
+ ## 4. Milestones
+ 
+ ### MVP v1 (Must-Have Features)
+ 
+ **Target**: Production-ready MVP with core functionality
+ 
+ **Features**:
+ - ✅ Chrome Extension loads in Chrome
+ - ✅ Side panel UI with futuristic dark theme
+ - ✅ Image detection and "Cap!" button injection
+ - ✅ Image capture (URL + metadata)
+ - ✅ Board persistence (chrome.storage.local + IndexedDB)
+ - ✅ Board grid with empty state placeholders
+ - ✅ 80/100 item limit enforcement
+ - ✅ Export JSON
+ - ✅ Export ZIP (with JSZip)
+ - ✅ Toast notifications (success/error with retry)
+ - ✅ Strict CSP and minimal permissions
+ - ✅ Input validation (URLs, metadata, timestamps)
+ - ✅ Filename sanitization for exports
+ - ✅ Error handling (no internal path exposure)
+ 
+ **Success Criteria**:
+ - Extension loads without errors
+ - Captures appear in board within 2 seconds
+ - Board persists across browser restarts
+ - Exports generate valid files
+ - No CSP violations
+ - No XSS vulnerabilities
+ 
+ ### v1.5 (Improved Robustness)
+ 
+ **Target**: Enhanced reliability and security
+ 
+ **Features**:
+ - ✅ MIME type validation for images
+ - ✅ Image size limits (10MB per image, 10MP dimensions)
+ - ✅ SHA-256 content hashing for duplicate detection
+ - ✅ Better capture/dedupe messaging
+ - ✅ Export hardening (ZIP size limits, file count limits)
+ - ✅ Storage quota monitoring and warnings
+ - ✅ Improved error messages (user-friendly)
+ - ✅ Performance optimization (virtual scrolling for 100 items)
+ 
+ **Success Criteria**:
+ - Handles oversized images gracefully
+ - Duplicate detection works reliably
+ - Exports complete for boards up to 100 items
+ - Storage quota warnings appear at 80% usage
+ 
+ ### v2 (Phase 2 - Optional)
+ 
+ **Target**: Local Next.js integration
+ 
+ **Features**:
+ - ✅ Next.js API endpoint (&#96;POST /api/capture&#96;)
+ - ✅ Extension → Next.js communication (localhost:3000 only)
+ - ✅ Fallback to extension storage when API unavailable
+ - ✅ Board view in Next.js app
+ - ✅ Optional tab capture fallback for CORS-blocked images
+ 
+ **Success Criteria**:
+ - Extension successfully posts to local API when available
+ - Graceful fallback when API unavailable
+ - Board view displays captured items
+ - Tab capture works for CORS-blocked images
+ 
+ ---
+ 
+ ## 5. Step-by-Step Implementation Plan
+ 
+ ### Phase 0: Setup &amp; Build Pipeline
+ 
+ **Tasks**:
+ 1. **Setup Extension Build**
+    - Initialize TypeScript config for extension
+    - Configure bundler (Vite or esbuild)
+    - Create manifest.json with minimal permissions
+    - Setup CSP in manifest
+    - Test extension loads in Chrome
+ 
+ 2. **Setup Next.js Build** (Phase 2 prep)
+    - Verify Next.js setup (already exists)
+    - Configure TypeScript paths for shared code
+    - Test build pipeline
+ 
+ 3. **Setup Shared Code Structure**
+    - Create &#96;shared/&#96; directory
+    - Configure TypeScript project references
+    - Setup validation utilities
+ 
+ **Deliverables**:
+ - Extension loads in Chrome
+ - Build scripts work
+ - TypeScript compiles without errors
+ 
+ ### Phase 1: Core UI Components
+ 
+ **Tasks**:
+ 1. **Design System Setup**
+    - Configure Tailwind for dark mode
+    - Define color palette (teal/cyan/electric blue)
+    - Create utility classes for glassmorphism
+    - Define typography scale
+ 
+ 2. **Build Base Components**
+    - &#96;Header.tsx&#96;: Browser-like header with URL bar
+    - &#96;ActionButton.tsx&#96;: Reusable button with hover/active states
+    - &#96;ImageCard.tsx&#96;: Image card with "Cap!" button overlay
+    - &#96;ImageGrid.tsx&#96;: Grid layout with empty state
+    - &#96;CapBoardPanel.tsx&#96;: Right-side panel with board grid and actions
+ 
+ 3. **Implement Side Panel**
+    - Create &#96;side-panel.html&#96;
+    - Integrate React components
+    - Setup Tailwind styles
+    - Test responsive layout
+ 
+ **Deliverables**:
+ - All UI components render correctly
+ - Dark theme with glassmorphism effects
+ - Hover states and transitions work
+ - Side panel opens and displays correctly
+ 
+ ### Phase 2: Content Script &amp; Image Detection
+ 
+ **Tasks**:
+ 1. **Content Script Implementation**
+    - Create &#96;content-script.ts&#96;
+    - Implement image detection (querySelector for &#96;&lt;img&gt;&#96;)
+    - Inject "Cap!" buttons (with isolation)
+    - Setup message passing to service worker
+ 
+ 2. **Security Hardening**
+    - Verify isolated world (no unsafeWindow)
+    - Sanitize DOM manipulation
+    - Validate message shapes
+    - Test XSS prevention
+ 
+ 3. **Image Detection Logic**
+    - Filter valid image sources (http/https/data)
+    - Handle lazy-loaded images
+    - Handle background images (optional)
+    - Handle SVG images (optional)
+ 
+ **Deliverables**:
+ - Content script injects without breaking pages
+ - "Cap!" buttons appear on images
+ - No console errors on common websites
+ - XSS prevention verified
+ 
+ ### Phase 3: Message Contracts &amp; Validation
+ 
+ **Tasks**:
+ 1. **Define Message Types**
+    - Create TypeScript interfaces for messages
+    - Define capture request/response
+    - Define storage update messages
+    - Define export request messages
+ 
+ 2. **Implement Schema Validation**
+    - Create &#96;schema-validator.ts&#96;
+    - Validate URLs (block javascript:)
+    - Validate metadata structure
+    - Validate timestamps
+ 
+ 3. **Implement Message Handlers**
+    - Service worker message router
+    - Content script message sender
+    - Validation at boundaries
+ 
+ **Deliverables**:
+ - Message contracts defined
+ - Validation prevents invalid data
+ - Messages pass between contexts securely
+ 
+ ### Phase 4: Storage Layer
+ 
+ **Tasks**:
+ 1. **Storage Adapters**
+    - Implement &#96;storage-adapter.ts&#96; (chrome.storage.local)
+    - Implement &#96;indexeddb-adapter.ts&#96; (for blobs)
+    - Create storage interface/abstraction
+ 
+ 2. **Data Models**
+    - Define &#96;CapturedItem&#96; type
+    - Define &#96;CapBoard&#96; type
+    - Implement serialization/deserialization
+ 
+ 3. **Storage Operations**
+    - Save captured item
+    - Load board on panel open
+    - Remove item
+    - Clear board
+    - Quota monitoring
+ 
+ 4. **Limit Enforcement**
+    - Check board size before capture
+    - Show warning at 80 items
+    - Block capture at 100 items
+    - Update UI accordingly
+ 
+ **Deliverables**:
+ - Storage operations work correctly
+ - Board persists across restarts
+ - 80/100 limit enforced
+ - Quota monitoring active
+ 
+ ### Phase 5: Image Capture Logic
+ 
+ **Tasks**:
+ 1. **Capture Strategy**
+    - Implement URL capture (primary)
+    - Implement blob fetch (best-effort)
+    - Handle CORS failures gracefully
+    - Store fallback indicator
+ 
+ 2. **Image Validation**
+    - Validate image URLs
+    - Validate MIME types (v1.5)
+    - Validate image size (v1.5)
+    - Handle corrupted images
+ 
+ 3. **Duplicate Detection**
+    - Implement URL-based duplicate check (v1)
+    - Implement content hash (SHA-256) (v1.5)
+    - Show appropriate messages
+ 
+ 4. **Thumbnail Generation**
+    - Generate thumbnails for grid
+    - Store thumbnail data
+    - Handle thumbnail failures
+ 
+ **Deliverables**:
+ - Images capture successfully
+ - CORS failures handled gracefully
+ - Duplicates detected (URL-based in v1)
+ - Thumbnails display in grid
+ 
+ ### Phase 6: Board UI &amp; Interactions
+ 
+ **Tasks**:
+ 1. **Grid Implementation**
+    - Render captured items as thumbnails
+    - Implement empty state placeholders
+    - Implement infinite scroll (virtual scrolling)
+    - Handle grid updates on capture/remove
+ 
+ 2. **Remove Functionality**
+    - Add remove button to items
+    - Implement remove handler
+    - Update storage
+    - Update UI
+ 
+ 3. **Clear Board**
+    - Implement clear button
+    - Add confirmation modal
+    - Clear storage
+    - Reset UI
+ 
+ **Deliverables**:
+ - Grid displays captured items
+ - Empty states show correctly
+ - Remove works for individual items
+ - Clear board works with confirmation
+ 
+ ### Phase 7: Export Functionality
+ 
+ **Tasks**:
+ 1. **JSON Export**
+    - Generate JSON manifest
+    - Include all metadata
+    - Validate JSON structure
+    - Download via chrome.downloads API
+ 
+ 2. **Individual Image Export**
+    - Fetch images (handle CORS)
+    - Generate unique filenames
+    - Sanitize filenames
+    - Download multiple files
+ 
+ 3. **ZIP Export**
+    - Install JSZip dependency
+    - Create ZIP structure
+    - Add images folder
+    - Add board.json manifest
+    - Implement size limits
+    - Download ZIP
+ 
+ 4. **Export Security**
+    - Filename sanitization
+    - JSON validation
+    - ZIP size limits
+    - File count limits
+ 
+ **Deliverables**:
+ - JSON export generates valid files
+ - Individual images export correctly
+ - ZIP export works for boards up to 50 items (v1), 100 items (v1.5)
+ - Filenames are sanitized
+ 
+ ### Phase 8: Error Handling &amp; Toasts
+ 
+ **Tasks**:
+ 1. **Toast System**
+    - Create toast component
+    - Implement toast queue
+    - Show success/error messages
+    - Add retry button for errors
+ 
+ 2. **Error Categories**
+    - Permission errors
+    - CORS errors
+    - Storage errors
+    - Export errors
+ 
+ 3. **User-Friendly Messages**
+    - Map errors to user messages
+    - Hide internal paths
+    - Provide actionable guidance
+    - Log detailed errors (extension logs only)
+ 
+ **Deliverables**:
+ - Toasts appear for all actions
+ - Error messages are user-friendly
+ - Retry functionality works
+ - No internal paths exposed
+ 
+ ### Phase 9: Phase 2 - Local API Integration (Optional)
+ 
+ **Tasks**:
+ 1. **Next.js API Endpoint**
+    - Create &#96;POST /api/capture&#96; route
+    - Validate payload structure
+    - Store in local database (or file system)
+    - Return success/error response
+ 
+ 2. **Extension → API Communication**
+    - Detect localhost:3000 availability
+    - Post capture payload
+    - Handle timeouts
+    - Fallback to extension storage
+ 
+ 3. **Board View in Next.js**
+    - Create &#96;/board&#96; page
+    - Display captured items
+    - Sync with extension (optional)
+ 
+ **Deliverables**:
+ - API endpoint accepts captures
+ - Extension posts to API when available
+ - Fallback works when API unavailable
+ - Board view displays items
+ 
+ ---
+ 
+ ## 6. Risks &amp; Mitigations
+ 
+ ### 6.1 Technical Risks
+ 
+ | Risk | Impact | Probability | Mitigation |
+ |------|--------|-------------|------------|
+ | **CORS limitations prevent image capture** | High | High | Start with URL capture; document CORS limitations; implement tab capture fallback (v2) |
+ | **Storage quota exceeded** | Medium | Medium | Monitor quota; enforce 100-item limit; show warnings at 80% usage; handle errors gracefully |
+ | **Performance degradation with 100 items** | Medium | Low | Implement virtual scrolling; optimize thumbnail rendering; lazy load images |
+ | **XSS via metadata/DOM** | High | Low | Validate all inputs; sanitize user-visible strings; use isolated world; test XSS prevention |
+ | **Over-broad permissions** | Medium | Low | Use activeTab instead of *://*/*; document permission rationale; review in security checklist |
+ | **Export path traversal / ZIP bombs** | High | Low | Sanitize filenames; limit ZIP size; limit file count; validate JSON structure |
+ | **Memory exhaustion from large images** | Medium | Medium | Implement size limits (10MB, 10MP); reject/resize oversized images; handle gracefully |
+ | **Content script conflicts with page** | Low | Medium | Use isolated world; minimal DOM manipulation; test on common websites |
+ 
+ ### 6.2 Security Risks
+ 
+ | Risk | Impact | Probability | Mitigation |
+ |------|--------|-------------|------------|
+ | **XSS in content script** | High | Low | Isolated world; validate messages; sanitize DOM; test XSS prevention |
+ | **Storage DoS attack** | Medium | Low | Enforce 100-item limit; monitor quota; validate inputs; handle errors |
+ | **Malicious image URLs** | Medium | Low | Validate URLs (block javascript:); validate MIME types; handle corrupted images |
+ | **CSP violations** | Medium | Low | Strict CSP; test violations; no eval/inline scripts |
+ | **Localhost API SSRF** (Phase 2) | Low | Low | Validate localhost origin only; timeout requests; validate responses |
+ 
+ ### 6.3 Product Risks
+ 
+ | Risk | Impact | Probability | Mitigation |
+ |------|--------|-------------|------------|
+ | **UI doesn't match design vision** | Medium | Medium | Create design system early; iterate on components; test with users |
+ | **Extension breaks on some websites** | Medium | Medium | Test on common websites; handle errors gracefully; document limitations |
+ | **Export fails for large boards** | Low | Low | Implement size limits; test with 50+ items; optimize ZIP generation |
+ 
+ ---
+ 
+ ## 7. Acceptance Criteria Highlights
+ 
+ ### Core Functionality
+ - [ ] Extension loads in Chrome without errors
+ - [ ] Side panel opens and displays UI correctly
+ - [ ] Images are detected and "Cap!" buttons appear
+ - [ ] Capture adds item to board within 2 seconds
+ - [ ] Board persists across browser restarts
+ - [ ] 80/100 limit enforced with warnings
+ 
+ ### Security
+ - [ ] Minimal permissions requested (activeTab, storage, scripting)
+ - [ ] CSP violations blocked
+ - [ ] XSS prevention verified
+ - [ ] Input validation tested (malicious URLs)
+ - [ ] Filename sanitization verified
+ - [ ] No internal paths in error messages
+ 
+ ### UI/Design
+ - [ ] Dark mode with glassmorphism effects
+ - [ ] Hover states and transitions work
+ - [ ] Grid displays items correctly
+ - [ ] Empty states show placeholders
+ - [ ] Toasts appear for actions
+ 
+ ### Export
+ - [ ] JSON export generates valid files
+ - [ ] Individual images export correctly
+ - [ ] ZIP export works for 50+ items
+ - [ ] CORS-blocked images handled gracefully
+ 
+ ---
+ 
+ ## 8. Next Steps
+ 
+ 1. **Update Main Spec**: Add Security Requirements and UI/Design Requirements sections
+ 2. **Create Initial UI Components**: Build JSX components with Tailwind (see separate deliverable)
+ 3. **Setup Build Pipeline**: Configure extension build system
+ 4. **Begin Phase 0 Implementation**: Setup and build pipeline
+ 
+ ---
+ 
+ ## Appendix: Technology Decisions
+ 
+ ### Build Tools
+ - **Extension**: Vite or esbuild (TBD based on complexity)
+ - **Web**: Next.js (already configured)
+ - **TypeScript**: Yes (type safety)
+ 
+ ### Dependencies
+ - **JSZip**: For ZIP export
+ - **Tailwind CSS**: For styling (no external UI libraries)
+ - **React**: For UI components (extension + web)
+ 
+ ### Storage Strategy
+ - **Metadata**: chrome.storage.local (10MB default quota)
+ - **Image Blobs**: IndexedDB (larger quota, better for blobs)
+ - **Fallback**: URL-only storage if blob fetch fails
+ 
+ ### Capture Strategy
+ 1. **Primary**: Store image URL + metadata
+ 2. **Best-effort**: Fetch blob (handle CORS gracefully)
+ 3. **Fallback** (v2): Tab capture for CORS-blocked images
+ 
+ ---
+ 
+ **End of Implementation Plan**
+ 
```

</details>

</tool-use>

---



---


Updating the main spec with Security and UI/Design requirements, then creating the initial UI components:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: specs/001-capthat-extension/spec.md</summary>

</details>
</tool-use>

---



---


Adding Security and UI/Design requirements to the spec:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: specs/001-capthat-extension/spec.md</summary>

**Chunk 1**
Lines added: 74, lines removed: undefined

```diff
@@ -342,4 +342,78 @@
  - **FR-047**: System MUST fall back to extension-only storage when local app is not running (Phase 2)
  - **FR-048**: System MUST show "Local app not detected" message when local app is not available (Phase 2)
+ 
+ ### Security Requirements
+ 
+ #### Non-Functional Requirements
+ - **NFR-SEC-001**: Extension MUST request minimal permissions (prefer &#96;activeTab&#96; over &#96;*://*/*&#96;)
+ - **NFR-SEC-002**: Extension MUST implement strict Content Security Policy (no &#96;eval()&#96;, no inline scripts)
+ - **NFR-SEC-003**: Content scripts MUST use isolated world (no &#96;unsafeWindow&#96; or direct page context access)
+ - **NFR-SEC-004**: All inputs MUST be validated before storage (URLs, metadata, timestamps)
+ - **NFR-SEC-005**: URLs MUST be sanitized (block &#96;javascript:&#96; and other dangerous schemes)
+ - **NFR-SEC-006**: Storage quota MUST be monitored (prevent DoS via storage exhaustion)
+ - **NFR-SEC-007**: Image size MUST be limited (prevent memory exhaustion: 10MB per image, 10MP dimensions)
+ - **NFR-SEC-008**: Export filenames MUST be sanitized (prevent path traversal: remove &#96;/&#96;, &#96;\&#96;, &#96;..&#96;, etc.)
+ - **NFR-SEC-009**: Error messages MUST NOT expose internal paths or storage structure
+ - **NFR-SEC-010**: Phase 2 API MUST only communicate with &#96;http://localhost:3000&#96; (validate origin)
+ 
+ #### Acceptance Criteria
+ - [AC-SEC-001] Manifest permissions reviewed and justified in implementation
+ - [AC-SEC-002] CSP violations blocked in testing (no eval, no inline scripts)
+ - [AC-SEC-003] XSS prevention verified in content scripts (isolated world, sanitized DOM)
+ - [AC-SEC-004] Input validation tested with malicious URLs (&#96;javascript:&#96;, &#96;data:&#96; schemes)
+ - [AC-SEC-005] Storage quota handling tested (warnings at 80% usage, errors at 100%)
+ - [AC-SEC-006] Export filename sanitization verified (no path traversal characters)
+ - [AC-SEC-007] Image MIME type validation implemented (JPEG, PNG, GIF, WebP only)
+ - [AC-SEC-008] Image size limits enforced (reject or resize oversized images)
+ - [AC-SEC-009] Error messages are user-friendly (no internal paths exposed)
+ - [AC-SEC-010] Localhost API origin validation tested (reject non-localhost requests)
+ 
+ **Detailed Security Checklist**: See [checklists/security.md](./checklists/security.md) for comprehensive threat model and testing requirements.
+ 
+ ### UI/Design Requirements
+ 
+ #### Visual Style
+ - **UI-001**: Dark mode by default (dark background with light text)
+ - **UI-002**: Glassmorphism / soft translucency panels (backdrop-blur effects)
+ - **UI-003**: Subtle gradients (teal/cyan/electric blue accents)
+ - **UI-004**: Soft glows + ambient shadows (subtle elevation effects)
+ - **UI-005**: Rounded corners, thin borders (modern, clean aesthetic)
+ - **UI-006**: Low-contrast grid background (subtle dot pattern or gradient)
+ - **UI-007**: Minimal text; strong visual hierarchy (icons over labels where possible)
+ 
+ #### Layout Requirements
+ - **UI-008**: Top browser-like header with URL bar and subtle navigation arrows (back/forward)
+ - **UI-009**: Main content: grid of image cards with floating "Cap!" action buttons
+ - **UI-010**: Right-side floating panel:
+   - Title "CapThat!" in header
+   - Cap Board grid (captured items in grid layout)
+   - Action buttons: Clear Cap Board, Export JSON, Export CapBoard, Export Individual Caps
+ - **UI-011**: Modular component structure required:
+   - &#96;Header&#96; component (browser-like header)
+   - &#96;ImageGrid&#96; component (main content grid)
+   - &#96;ImageCard&#96; component (individual image card with "Cap!" button)
+   - &#96;CapBoardPanel&#96; component (right-side panel)
+   - &#96;ActionButton&#96; component (reusable button with states)
+ 
+ #### Interaction Requirements
+ - **UI-012**: Hover states (subtle glow and/or scale transform)
+ - **UI-013**: Button press micro-interactions (active state feedback)
+ - **UI-014**: Smooth transitions (200–300ms duration)
+ - **UI-015**: Cards lift slightly on hover (elevation increase)
+ 
+ #### Accessibility Requirements
+ - **UI-016**: High contrast text on dark background (WCAG AA compliance)
+ - **UI-017**: Keyboard navigable buttons (tab navigation, Enter/Space activation)
+ - **UI-018**: Clean Tailwind class usage (no external UI libraries)
+ 
+ #### Acceptance Criteria
+ - [AC-UI-001] Dark mode theme applied consistently across all components
+ - [AC-UI-002] Glassmorphism effects visible on panels (backdrop-blur, transparency)
+ - [AC-UI-003] Teal/cyan/electric blue accents used for primary actions
+ - [AC-UI-004] Hover states trigger on all interactive elements
+ - [AC-UI-005] Transitions are smooth (200–300ms, no jank)
+ - [AC-UI-006] Grid layout is responsive (works at 1024px+ widths)
+ - [AC-UI-007] All buttons are keyboard accessible
+ - [AC-UI-008] Text contrast meets WCAG AA standards
  
  ### Key Entities *(include if feature involves data)*
```

</details>

</tool-use>

---



---


Creating the initial UI components with Tailwind styling:


---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** • Edit file: specs/001-capthat-extension/ui-components/Header.tsx</summary>

**Chunk 1**
Lines added: 88, lines removed: 1

```diff
@@ -1,1 +1,88 @@
- 
+ /**
+  * Header Component
+  * Browser-like header with URL bar and navigation arrows
+  * Futuristic dark theme with glassmorphism
+  */
+ 
+ import React from 'react';
+ 
+ interface HeaderProps {
+   currentUrl?: string;
+   onBack?: () =&gt; void;
+   onForward?: () =&gt; void;
+   canGoBack?: boolean;
+   canGoForward?: boolean;
+ }
+ 
+ export const Header: React.FC&lt;HeaderProps&gt; = ({
+   currentUrl = 'https://www.example.com',
+   onBack,
+   onForward,
+   canGoBack = false,
+   canGoForward = false,
+ }) =&gt; {
+   return (
+     &lt;header className="relative w-full bg-gradient-to-r from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-md border-b border-cyan-500/20 shadow-lg shadow-cyan-500/10"&gt;
+       &lt;div className="flex items-center gap-2 px-4 py-3"&gt;
+         {/* Navigation Arrows */}
+         &lt;div className="flex items-center gap-1"&gt;
+           &lt;button
+             onClick={onBack}
+             disabled={!canGoBack}
+             className="flex items-center justify-center w-8 h-8 rounded-md bg-slate-700/50 hover:bg-slate-600/70 disabled:opacity-30 disabled:cursor-not-allowed transition-all duration-200 hover:scale-105 border border-cyan-500/10 hover:border-cyan-500/30 hover:shadow-sm hover:shadow-cyan-500/20"
+             aria-label="Go back"
+           &gt;
+             &lt;svg
+               className="w-4 h-4 text-cyan-400"
+               fill="none"
+               stroke="currentColor"
+               viewBox="0 0 24 24"
+             &gt;
+               &lt;path
+                 strokeLinecap="round"
+                 strokeLinejoin="round"
+                 strokeWidth={2}
+                 d="M15 19l-7-7 7-7"
+               /&gt;
+             &lt;/svg&gt;
+           &lt;/button&gt;
+           &lt;button
+             onClick={onForward}
+             disabled={!canGoForward}
+             className="flex items-center justify-center w-8 h-8 rounded-md bg-slate-700/50 hover:bg-slate-600/70 disabled:opacity-30 disabled:cursor-not-allowed transition-all duration-200 hover:scale-105 border border-cyan-500/10 hover:border-cyan-500/30 hover:shadow-sm hover:shadow-cyan-500/20"
+             aria-label="Go forward"
+           &gt;
+             &lt;svg
+               className="w-4 h-4 text-cyan-400"
+               fill="none"
+               stroke="currentColor"
+               viewBox="0 0 24 24"
+             &gt;
+               &lt;path
+                 strokeLinecap="round"
+                 strokeLinejoin="round"
+                 strokeWidth={2}
+                 d="M9 5l7 7-7 7"
+               /&gt;
+             &lt;/svg&gt;
+           &lt;/button&gt;
+         &lt;/div&gt;
+ 
+         {/* URL Bar */}
+         &lt;div className="flex-1 relative"&gt;
+           &lt;input
+             type="text"
+             value={currentUrl}
+             readOnly
+             className="w-full px-4 py-2 pr-10 bg-slate-800/60 backdrop-blur-sm border border-cyan-500/20 rounded-lg text-sm text-slate-200 placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all duration-200"
+             aria-label="Current page URL"
+           /&gt;
+           &lt;div className="absolute right-3 top-1/2 -translate-y-1/2"&gt;
+             &lt;div className="w-2 h-2 rounded-full bg-cyan-400/60 animate-pulse" /&gt;
+           &lt;/div&gt;
+         &lt;/div&gt;
+       &lt;/div&gt;
+     &lt;/header&gt;
+   );
+ };
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** • Edit file: specs/001-capthat-extension/ui-components/ActionButton.tsx</summary>

**Chunk 1**
Lines added: 58, lines removed: 1

```diff
@@ -1,1 +1,58 @@
- 
+ /**
+  * ActionButton Component
+  * Reusable button with hover states and micro-interactions
+  * Futuristic styling with teal/cyan accents
+  */
+ 
+ import React from 'react';
+ 
+ interface ActionButtonProps {
+   label: string;
+   onClick: () =&gt; void;
+   variant?: 'primary' | 'secondary' | 'danger';
+   size?: 'sm' | 'md' | 'lg';
+   disabled?: boolean;
+   icon?: React.ReactNode;
+   className?: string;
+ }
+ 
+ export const ActionButton: React.FC&lt;ActionButtonProps&gt; = ({
+   label,
+   onClick,
+   variant = 'primary',
+   size = 'md',
+   disabled = false,
+   icon,
+   className = '',
+ }) =&gt; {
+   const baseStyles =
+     'inline-flex items-center justify-center gap-2 font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 disabled:opacity-50 disabled:cursor-not-allowed active:scale-95';
+ 
+   const variantStyles = {
+     primary:
+       'bg-gradient-to-r from-cyan-500/90 to-teal-500/90 hover:from-cyan-400 hover:to-teal-400 text-white border border-cyan-400/30 hover:border-cyan-300/50 shadow-lg shadow-cyan-500/20 hover:shadow-cyan-400/30 focus:ring-cyan-500',
+     secondary:
+       'bg-slate-700/60 hover:bg-slate-600/80 text-slate-200 border border-slate-600/50 hover:border-slate-500/70 shadow-md shadow-slate-900/50 hover:shadow-lg focus:ring-slate-500',
+     danger:
+       'bg-gradient-to-r from-red-600/90 to-rose-600/90 hover:from-red-500 hover:to-rose-500 text-white border border-red-500/30 hover:border-red-400/50 shadow-lg shadow-red-500/20 hover:shadow-red-400/30 focus:ring-red-500',
+   };
+ 
+   const sizeStyles = {
+     sm: 'px-3 py-1.5 text-xs',
+     md: 'px-4 py-2 text-sm',
+     lg: 'px-6 py-3 text-base',
+   };
+ 
+   return (
+     &lt;button
+       onClick={onClick}
+       disabled={disabled}
+       className={&#96;${baseStyles} ${variantStyles[variant]} ${sizeStyles[size]} ${className}&#96;}
+       aria-label={label}
+     &gt;
+       {icon &amp;&amp; &lt;span className="flex-shrink-0"&gt;{icon}&lt;/span&gt;}
+       &lt;span&gt;{label}&lt;/span&gt;
+     &lt;/button&gt;
+   );
+ };
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** • Edit file: specs/001-capthat-extension/ui-components/ImageCard.tsx</summary>

**Chunk 1**
Lines added: 97, lines removed: 1

```diff
@@ -1,1 +1,97 @@
- 
+ /**
+  * ImageCard Component
+  * Individual image card with floating "Cap!" button overlay
+  * Hover effects with lift and glow
+  */
+ 
+ import React from 'react';
+ import { ActionButton } from './ActionButton';
+ 
+ interface ImageCardProps {
+   imageUrl: string;
+   alt?: string;
+   onCapture: () =&gt; void;
+   isCaptured?: boolean;
+   metadata?: {
+     title?: string;
+     domain?: string;
+   };
+ }
+ 
+ export const ImageCard: React.FC&lt;ImageCardProps&gt; = ({
+   imageUrl,
+   alt = 'Capturable image',
+   onCapture,
+   isCaptured = false,
+   metadata,
+ }) =&gt; {
+   return (
+     &lt;div className="group relative w-full aspect-square rounded-xl overflow-hidden bg-slate-800/40 backdrop-blur-sm border border-cyan-500/20 hover:border-cyan-500/40 transition-all duration-300 hover:shadow-xl hover:shadow-cyan-500/20 hover:-translate-y-1"&gt;
+       {/* Image */}
+       &lt;div className="absolute inset-0"&gt;
+         &lt;img
+           src={imageUrl}
+           alt={alt}
+           className="w-full h-full object-cover"
+           loading="lazy"
+         /&gt;
+         {/* Overlay gradient for better button visibility */}
+         &lt;div className="absolute inset-0 bg-gradient-to-t from-slate-900/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300" /&gt;
+       &lt;/div&gt;
+ 
+       {/* Metadata (optional) */}
+       {metadata &amp;&amp; (metadata.title || metadata.domain) &amp;&amp; (
+         &lt;div className="absolute top-2 left-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300"&gt;
+           &lt;div className="bg-slate-900/80 backdrop-blur-sm rounded-lg px-2 py-1 text-xs text-slate-200"&gt;
+             {metadata.title &amp;&amp; (
+               &lt;div className="font-medium truncate"&gt;{metadata.title}&lt;/div&gt;
+             )}
+             {metadata.domain &amp;&amp; (
+               &lt;div className="text-cyan-400/80 text-[10px] truncate"&gt;
+                 {metadata.domain}
+               &lt;/div&gt;
+             )}
+           &lt;/div&gt;
+         &lt;/div&gt;
+       )}
+ 
+       {/* Cap! Button - Floating in bottom-right */}
+       &lt;div className="absolute bottom-3 right-3 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0"&gt;
+         &lt;button
+           onClick={onCapture}
+           disabled={isCaptured}
+           className="flex items-center justify-center w-12 h-12 rounded-full bg-gradient-to-br from-cyan-500 to-teal-500 hover:from-cyan-400 hover:to-teal-400 text-white font-bold text-sm shadow-lg shadow-cyan-500/40 hover:shadow-cyan-400/50 transition-all duration-200 hover:scale-110 active:scale-95 border border-cyan-300/30 disabled:opacity-50 disabled:cursor-not-allowed"
+           aria-label={isCaptured ? 'Already captured' : 'Capture image'}
+         &gt;
+           {isCaptured ? (
+             &lt;svg
+               className="w-5 h-5"
+               fill="none"
+               stroke="currentColor"
+               viewBox="0 0 24 24"
+             &gt;
+               &lt;path
+                 strokeLinecap="round"
+                 strokeLinejoin="round"
+                 strokeWidth={2}
+                 d="M5 13l4 4L19 7"
+               /&gt;
+             &lt;/svg&gt;
+           ) : (
+             'Cap!'
+           )}
+         &lt;/button&gt;
+       &lt;/div&gt;
+ 
+       {/* Captured indicator badge */}
+       {isCaptured &amp;&amp; (
+         &lt;div className="absolute top-2 right-2"&gt;
+           &lt;div className="bg-cyan-500/90 backdrop-blur-sm rounded-full px-2 py-1 text-xs font-medium text-white shadow-lg"&gt;
+             ✓ Captured
+           &lt;/div&gt;
+         &lt;/div&gt;
+       )}
+     &lt;/div&gt;
+   );
+ };
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** • Edit file: specs/001-capthat-extension/ui-components/ImageGrid.tsx</summary>

**Chunk 1**
Lines added: 84, lines removed: 1

```diff
@@ -1,1 +1,84 @@
- 
+ /**
+  * ImageGrid Component
+  * Main content grid of image cards
+  * Handles empty state placeholders
+  */
+ 
+ import React from 'react';
+ import { ImageCard } from './ImageCard';
+ 
+ interface ImageItem {
+   id: string;
+   imageUrl: string;
+   alt?: string;
+   metadata?: {
+     title?: string;
+     domain?: string;
+   };
+   isCaptured?: boolean;
+ }
+ 
+ interface ImageGridProps {
+   images: ImageItem[];
+   onCapture: (id: string) =&gt; void;
+   emptyMessage?: string;
+   gridCols?: number;
+ }
+ 
+ export const ImageGrid: React.FC&lt;ImageGridProps&gt; = ({
+   images,
+   onCapture,
+   emptyMessage = 'No images found on this page',
+   gridCols = 2,
+ }) =&gt; {
+   const gridColsClass = {
+     2: 'grid-cols-2',
+     3: 'grid-cols-3',
+     4: 'grid-cols-4',
+   }[gridCols] || 'grid-cols-2';
+ 
+   if (images.length === 0) {
+     return (
+       &lt;div className="flex items-center justify-center min-h-[400px] p-8"&gt;
+         &lt;div className="text-center"&gt;
+           &lt;div className="w-16 h-16 mx-auto mb-4 rounded-full bg-slate-800/60 backdrop-blur-sm border border-cyan-500/20 flex items-center justify-center"&gt;
+             &lt;svg
+               className="w-8 h-8 text-cyan-400/60"
+               fill="none"
+               stroke="currentColor"
+               viewBox="0 0 24 24"
+             &gt;
+               &lt;path
+                 strokeLinecap="round"
+                 strokeLinejoin="round"
+                 strokeWidth={2}
+                 d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
+               /&gt;
+             &lt;/svg&gt;
+           &lt;/div&gt;
+           &lt;p className="text-slate-400 text-sm"&gt;{emptyMessage}&lt;/p&gt;
+         &lt;/div&gt;
+       &lt;/div&gt;
+     );
+   }
+ 
+   return (
+     &lt;div
+       className={&#96;grid ${gridColsClass} gap-4 p-4 auto-rows-fr&#96;}
+       role="grid"
+       aria-label="Image grid"
+     &gt;
+       {images.map((image) =&gt; (
+         &lt;ImageCard
+           key={image.id}
+           imageUrl={image.imageUrl}
+           alt={image.alt}
+           onCapture={() =&gt; onCapture(image.id)}
+           isCaptured={image.isCaptured}
+           metadata={image.metadata}
+         /&gt;
+       ))}
+     &lt;/div&gt;
+   );
+ };
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** • Edit file: specs/001-capthat-extension/ui-components/CapBoardPanel.tsx</summary>

**Chunk 1**
Lines added: 281, lines removed: 1

```diff
@@ -1,1 +1,281 @@
- 
+ /**
+  * CapBoardPanel Component
+  * Right-side floating panel with board grid and action buttons
+  * Futuristic glassmorphism design
+  */
+ 
+ import React, { useState } from 'react';
+ import { ActionButton } from './ActionButton';
+ 
+ interface CapturedItem {
+   id: string;
+   imageUrl: string;
+   thumbnailUrl?: string;
+   sourceUrl: string;
+   timestamp: number;
+   metadata?: {
+     title?: string;
+     domain?: string;
+   };
+ }
+ 
+ interface CapBoardPanelProps {
+   items: CapturedItem[];
+   onClear: () =&gt; void;
+   onExportJSON: () =&gt; void;
+   onExportZIP: () =&gt; void;
+   onExportIndividual: () =&gt; void;
+   onRemoveItem?: (id: string) =&gt; void;
+   maxItems?: number;
+   warningThreshold?: number;
+ }
+ 
+ export const CapBoardPanel: React.FC&lt;CapBoardPanelProps&gt; = ({
+   items,
+   onClear,
+   onExportJSON,
+   onExportZIP,
+   onExportIndividual,
+   onRemoveItem,
+   maxItems = 100,
+   warningThreshold = 80,
+ }) =&gt; {
+   const [showClearConfirm, setShowClearConfirm] = useState(false);
+ 
+   const itemCount = items.length;
+   const isNearLimit = itemCount &gt;= warningThreshold;
+   const isAtLimit = itemCount &gt;= maxItems;
+ 
+   const handleClear = () =&gt; {
+     if (showClearConfirm) {
+       onClear();
+       setShowClearConfirm(false);
+     } else {
+       setShowClearConfirm(true);
+     }
+   };
+ 
+   const gridCols = 4; // 4 columns for board grid
+ 
+   return (
+     &lt;div className="fixed right-0 top-0 h-full w-96 bg-gradient-to-br from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-xl border-l border-cyan-500/20 shadow-2xl shadow-cyan-500/10 flex flex-col"&gt;
+       {/* Header */}
+       &lt;div className="px-6 py-4 border-b border-cyan-500/20 bg-slate-900/50 backdrop-blur-sm"&gt;
+         &lt;h2 className="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-teal-400 bg-clip-text text-transparent"&gt;
+           CapThat!
+         &lt;/h2&gt;
+         {isNearLimit &amp;&amp; (
+           &lt;div
+             className={&#96;mt-2 text-xs px-2 py-1 rounded ${
+               isAtLimit
+                 ? 'bg-red-500/20 text-red-400 border border-red-500/30'
+                 : 'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30'
+             }&#96;}
+           &gt;
+             {isAtLimit
+               ? &#96;Board full (${itemCount}/${maxItems})&#96;
+               : &#96;Approaching limit (${itemCount}/${maxItems})&#96;}
+           &lt;/div&gt;
+         )}
+       &lt;/div&gt;
+ 
+       {/* Board Grid */}
+       &lt;div className="flex-1 overflow-y-auto p-4"&gt;
+         {items.length === 0 ? (
+           &lt;div className="flex items-center justify-center h-full"&gt;
+             &lt;div className="text-center"&gt;
+               &lt;div className="w-20 h-20 mx-auto mb-4 rounded-xl bg-slate-800/40 backdrop-blur-sm border border-cyan-500/20 flex items-center justify-center"&gt;
+                 &lt;svg
+                   className="w-10 h-10 text-cyan-400/40"
+                   fill="none"
+                   stroke="currentColor"
+                   viewBox="0 0 24 24"
+                 &gt;
+                   &lt;path
+                     strokeLinecap="round"
+                     strokeLinejoin="round"
+                     strokeWidth={2}
+                     d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
+                   /&gt;
+                 &lt;/svg&gt;
+               &lt;/div&gt;
+               &lt;p className="text-slate-400 text-sm mb-1"&gt;Empty Cap Board&lt;/p&gt;
+               &lt;p className="text-slate-500 text-xs"&gt;
+                 Click "Cap!" to capture images
+               &lt;/p&gt;
+             &lt;/div&gt;
+           &lt;/div&gt;
+         ) : (
+           &lt;div
+             className={&#96;grid grid-cols-${gridCols} gap-2 auto-rows-fr&#96;}
+             role="grid"
+             aria-label="Cap board grid"
+           &gt;
+             {items.map((item) =&gt; (
+               &lt;div
+                 key={item.id}
+                 className="group relative aspect-square rounded-lg overflow-hidden bg-slate-800/40 backdrop-blur-sm border border-cyan-500/20 hover:border-cyan-500/40 transition-all duration-200 hover:shadow-lg hover:shadow-cyan-500/10"
+               &gt;
+                 &lt;img
+                   src={item.thumbnailUrl || item.imageUrl}
+                   alt={item.metadata?.title || 'Captured image'}
+                   className="w-full h-full object-cover"
+                   loading="lazy"
+                 /&gt;
+                 {/* Remove button on hover */}
+                 {onRemoveItem &amp;&amp; (
+                   &lt;button
+                     onClick={() =&gt; onRemoveItem(item.id)}
+                     className="absolute top-1 right-1 w-5 h-5 rounded-full bg-red-500/80 hover:bg-red-500 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center text-xs font-bold shadow-lg"
+                     aria-label="Remove item"
+                   &gt;
+                     ×
+                   &lt;/button&gt;
+                 )}
+                 {/* Metadata tooltip on hover */}
+                 {item.metadata &amp;&amp; (
+                   &lt;div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-slate-900/90 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200"&gt;
+                     {item.metadata.title &amp;&amp; (
+                       &lt;div className="text-xs text-slate-200 truncate"&gt;
+                         {item.metadata.title}
+                       &lt;/div&gt;
+                     )}
+                     {item.metadata.domain &amp;&amp; (
+                       &lt;div className="text-[10px] text-cyan-400/80 truncate"&gt;
+                         {item.metadata.domain}
+                       &lt;/div&gt;
+                     )}
+                   &lt;/div&gt;
+                 )}
+               &lt;/div&gt;
+             ))}
+           &lt;/div&gt;
+         )}
+       &lt;/div&gt;
+ 
+       {/* Action Buttons */}
+       &lt;div className="px-4 py-4 border-t border-cyan-500/20 bg-slate-900/50 backdrop-blur-sm space-y-2"&gt;
+         &lt;div className="grid grid-cols-2 gap-2"&gt;
+           &lt;ActionButton
+             label="Clear Cap Board"
+             onClick={handleClear}
+             variant="danger"
+             size="sm"
+             icon={
+               &lt;svg
+                 className="w-4 h-4"
+                 fill="none"
+                 stroke="currentColor"
+                 viewBox="0 0 24 24"
+               &gt;
+                 &lt;path
+                   strokeLinecap="round"
+                   strokeLinejoin="round"
+                   strokeWidth={2}
+                   d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
+                 /&gt;
+               &lt;/svg&gt;
+             }
+           /&gt;
+           &lt;ActionButton
+             label="Export JSON"
+             onClick={onExportJSON}
+             variant="secondary"
+             size="sm"
+             icon={
+               &lt;svg
+                 className="w-4 h-4"
+                 fill="none"
+                 stroke="currentColor"
+                 viewBox="0 0 24 24"
+               &gt;
+                 &lt;path
+                   strokeLinecap="round"
+                   strokeLinejoin="round"
+                   strokeWidth={2}
+                   d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
+                 /&gt;
+               &lt;/svg&gt;
+             }
+           /&gt;
+         &lt;/div&gt;
+         &lt;div className="grid grid-cols-2 gap-2"&gt;
+           &lt;ActionButton
+             label="Export CapBoard"
+             onClick={onExportZIP}
+             variant="secondary"
+             size="sm"
+             icon={
+               &lt;svg
+                 className="w-4 h-4"
+                 fill="none"
+                 stroke="currentColor"
+                 viewBox="0 0 24 24"
+               &gt;
+                 &lt;path
+                   strokeLinecap="round"
+                   strokeLinejoin="round"
+                   strokeWidth={2}
+                   d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
+                 /&gt;
+               &lt;/svg&gt;
+             }
+           /&gt;
+           &lt;ActionButton
+             label="Export Individual Caps"
+             onClick={onExportIndividual}
+             variant="secondary"
+             size="sm"
+             icon={
+               &lt;svg
+                 className="w-4 h-4"
+                 fill="none"
+                 stroke="currentColor"
+                 viewBox="0 0 24 24"
+               &gt;
+                 &lt;path
+                   strokeLinecap="round"
+                   strokeLinejoin="round"
+                   strokeWidth={2}
+                   d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
+                 /&gt;
+               &lt;/svg&gt;
+             }
+           /&gt;
+         &lt;/div&gt;
+       &lt;/div&gt;
+ 
+       {/* Clear Confirmation Modal */}
+       {showClearConfirm &amp;&amp; (
+         &lt;div className="absolute inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50"&gt;
+           &lt;div className="bg-slate-800/95 backdrop-blur-xl rounded-xl border border-red-500/30 shadow-2xl p-6 max-w-sm mx-4"&gt;
+             &lt;h3 className="text-lg font-semibold text-slate-200 mb-2"&gt;
+               Clear Cap Board?
+             &lt;/h3&gt;
+             &lt;p className="text-sm text-slate-400 mb-4"&gt;
+               This will permanently remove all {itemCount} captured items. This
+               action cannot be undone.
+             &lt;/p&gt;
+             &lt;div className="flex gap-2"&gt;
+               &lt;ActionButton
+                 label="Cancel"
+                 onClick={() =&gt; setShowClearConfirm(false)}
+                 variant="secondary"
+                 size="sm"
+                 className="flex-1"
+               /&gt;
+               &lt;ActionButton
+                 label="Clear All"
+                 onClick={handleClear}
+                 variant="danger"
+                 size="sm"
+                 className="flex-1"
+               /&gt;
+             &lt;/div&gt;
+           &lt;/div&gt;
+         &lt;/div&gt;
+       )}
+     &lt;/div&gt;
+   );
+ };
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** • Edit file: specs/001-capthat-extension/ui-components/MainLayout.tsx</summary>

**Chunk 1**
Lines added: 158, lines removed: 1

```diff
@@ -1,1 +1,158 @@
- 
+ /**
+  * MainLayout Component
+  * Complete page layout combining Header, ImageGrid, and CapBoardPanel
+  * Example usage showing the full UI structure
+  */
+ 
+ import React, { useState } from 'react';
+ import { Header } from './Header';
+ import { ImageGrid } from './ImageGrid';
+ import { CapBoardPanel } from './CapBoardPanel';
+ 
+ // Example data types
+ interface ImageItem {
+   id: string;
+   imageUrl: string;
+   alt?: string;
+   metadata?: {
+     title?: string;
+     domain?: string;
+   };
+   isCaptured?: boolean;
+ }
+ 
+ interface CapturedItem {
+   id: string;
+   imageUrl: string;
+   thumbnailUrl?: string;
+   sourceUrl: string;
+   timestamp: number;
+   metadata?: {
+     title?: string;
+     domain?: string;
+   };
+ }
+ 
+ export const MainLayout: React.FC = () =&gt; {
+   const [currentUrl, setCurrentUrl] = useState('https://www.example.com');
+   const [images, setImages] = useState&lt;ImageItem[]&gt;([
+     // Example images - replace with actual detected images
+     {
+       id: '1',
+       imageUrl: 'https://via.placeholder.com/400',
+       alt: 'Example image 1',
+       metadata: { title: 'Product Image', domain: 'example.com' },
+       isCaptured: false,
+     },
+     {
+       id: '2',
+       imageUrl: 'https://via.placeholder.com/400',
+       alt: 'Example image 2',
+       metadata: { title: 'Another Image', domain: 'example.com' },
+       isCaptured: false,
+     },
+   ]);
+ 
+   const [capturedItems, setCapturedItems] = useState&lt;CapturedItem[]&gt;([]);
+ 
+   const handleCapture = (imageId: string) =&gt; {
+     const image = images.find((img) =&gt; img.id === imageId);
+     if (!image) return;
+ 
+     // Add to captured items
+     const newItem: CapturedItem = {
+       id: imageId,
+       imageUrl: image.imageUrl,
+       sourceUrl: currentUrl,
+       timestamp: Date.now(),
+       metadata: image.metadata,
+     };
+ 
+     setCapturedItems([...capturedItems, newItem]);
+ 
+     // Mark as captured in images list
+     setImages(
+       images.map((img) =&gt;
+         img.id === imageId ? { ...img, isCaptured: true } : img
+       )
+     );
+   };
+ 
+   const handleRemoveItem = (itemId: string) =&gt; {
+     setCapturedItems(capturedItems.filter((item) =&gt; item.id !== itemId));
+     // Also mark as not captured in images list
+     setImages(
+       images.map((img) =&gt;
+         img.id === itemId ? { ...img, isCaptured: false } : img
+       )
+     );
+   };
+ 
+   const handleClear = () =&gt; {
+     setCapturedItems([]);
+     setImages(images.map((img) =&gt; ({ ...img, isCaptured: false })));
+   };
+ 
+   const handleExportJSON = () =&gt; {
+     console.log('Export JSON:', capturedItems);
+     // Implementation: Generate and download JSON
+   };
+ 
+   const handleExportZIP = () =&gt; {
+     console.log('Export ZIP:', capturedItems);
+     // Implementation: Generate and download ZIP
+   };
+ 
+   const handleExportIndividual = () =&gt; {
+     console.log('Export Individual:', capturedItems);
+     // Implementation: Download individual images
+   };
+ 
+   return (
+     &lt;div className="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950"&gt;
+       {/* Background grid pattern */}
+       &lt;div
+         className="fixed inset-0 opacity-10"
+         style={{
+           backgroundImage: &#96;radial-gradient(circle, #06b6d4 1px, transparent 1px)&#96;,
+           backgroundSize: '24px 24px',
+         }}
+       /&gt;
+ 
+       &lt;div className="relative z-10 flex flex-col h-screen"&gt;
+         {/* Header */}
+         &lt;Header
+           currentUrl={currentUrl}
+           onBack={() =&gt; console.log('Back')}
+           onForward={() =&gt; console.log('Forward')}
+         /&gt;
+ 
+         {/* Main Content Area */}
+         &lt;div className="flex-1 flex overflow-hidden"&gt;
+           {/* Left: Image Grid */}
+           &lt;div className="flex-1 overflow-y-auto"&gt;
+             &lt;ImageGrid
+               images={images}
+               onCapture={handleCapture}
+               emptyMessage="No images found on this page"
+               gridCols={2}
+             /&gt;
+           &lt;/div&gt;
+ 
+           {/* Right: Cap Board Panel */}
+           &lt;CapBoardPanel
+             items={capturedItems}
+             onClear={handleClear}
+             onExportJSON={handleExportJSON}
+             onExportZIP={handleExportZIP}
+             onExportIndividual={handleExportIndividual}
+             onRemoveItem={handleRemoveItem}
+             maxItems={100}
+             warningThreshold={80}
+           /&gt;
+         &lt;/div&gt;
+       &lt;/div&gt;
+     &lt;/div&gt;
+   );
+ };
+ 
```

</details>

</tool-use>

---



---


Creating a README for the UI components and checking for issues:


---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** • Edit file: specs/001-capthat-extension/ui-components/README.md</summary>

**Chunk 1**
Lines added: 99, lines removed: 1

```diff
@@ -1,1 +1,99 @@
- 
+ # CapThat UI Components
+ 
+ Initial UI implementation with futuristic dark theme using Tailwind CSS only.
+ 
+ ## Components
+ 
+ ### Header.tsx
+ Browser-like header with URL bar and navigation arrows.
+ 
+ **Props**:
+ - &#96;currentUrl?: string&#96; - Current page URL to display
+ - &#96;onBack?: () =&gt; void&#96; - Back button handler
+ - &#96;onForward?: () =&gt; void&#96; - Forward button handler
+ - &#96;canGoBack?: boolean&#96; - Whether back navigation is available
+ - &#96;canGoForward?: boolean&#96; - Whether forward navigation is available
+ 
+ ### ActionButton.tsx
+ Reusable button component with hover states and micro-interactions.
+ 
+ **Props**:
+ - &#96;label: string&#96; - Button text
+ - &#96;onClick: () =&gt; void&#96; - Click handler
+ - &#96;variant?: 'primary' | 'secondary' | 'danger'&#96; - Button style variant
+ - &#96;size?: 'sm' | 'md' | 'lg'&#96; - Button size
+ - &#96;disabled?: boolean&#96; - Disabled state
+ - &#96;icon?: React.ReactNode&#96; - Optional icon element
+ - &#96;className?: string&#96; - Additional CSS classes
+ 
+ ### ImageCard.tsx
+ Individual image card with floating "Cap!" button overlay.
+ 
+ **Props**:
+ - &#96;imageUrl: string&#96; - Image source URL
+ - &#96;alt?: string&#96; - Image alt text
+ - &#96;onCapture: () =&gt; void&#96; - Capture button handler
+ - &#96;isCaptured?: boolean&#96; - Whether image is already captured
+ - &#96;metadata?: { title?: string; domain?: string }&#96; - Optional metadata
+ 
+ ### ImageGrid.tsx
+ Main content grid of image cards with empty state handling.
+ 
+ **Props**:
+ - &#96;images: ImageItem[]&#96; - Array of image items to display
+ - &#96;onCapture: (id: string) =&gt; void&#96; - Capture handler (receives image ID)
+ - &#96;emptyMessage?: string&#96; - Message to show when no images
+ - &#96;gridCols?: number&#96; - Number of grid columns (2, 3, or 4)
+ 
+ ### CapBoardPanel.tsx
+ Right-side floating panel with board grid and action buttons.
+ 
+ **Props**:
+ - &#96;items: CapturedItem[]&#96; - Array of captured items
+ - &#96;onClear: () =&gt; void&#96; - Clear board handler
+ - &#96;onExportJSON: () =&gt; void&#96; - Export JSON handler
+ - &#96;onExportZIP: () =&gt; void&#96; - Export ZIP handler
+ - &#96;onExportIndividual: () =&gt; void&#96; - Export individual images handler
+ - &#96;onRemoveItem?: (id: string) =&gt; void&#96; - Remove individual item handler
+ - &#96;maxItems?: number&#96; - Maximum items allowed (default: 100)
+ - &#96;warningThreshold?: number&#96; - Warning threshold (default: 80)
+ 
+ ### MainLayout.tsx
+ Complete page layout example combining all components.
+ 
+ **Usage**: Reference implementation showing how components work together.
+ 
+ ## Design System
+ 
+ ### Colors
+ - **Primary Accent**: Cyan/Teal gradient (&#96;from-cyan-500 to-teal-500&#96;)
+ - **Background**: Dark slate (&#96;slate-900&#96;, &#96;slate-800&#96;)
+ - **Text**: Light slate (&#96;slate-200&#96;, &#96;slate-400&#96;)
+ - **Borders**: Cyan with opacity (&#96;cyan-500/20&#96;)
+ 
+ ### Effects
+ - **Glassmorphism**: &#96;backdrop-blur-md&#96; with semi-transparent backgrounds
+ - **Gradients**: Subtle gradients on buttons and backgrounds
+ - **Shadows**: Colored shadows with cyan/teal accents
+ - **Transitions**: 200-300ms smooth transitions
+ 
+ ### Typography
+ - **Headings**: Bold with gradient text (&#96;bg-clip-text text-transparent&#96;)
+ - **Body**: Regular weight, high contrast on dark background
+ 
+ ## Implementation Notes
+ 
+ 1. **Tailwind Only**: No external UI libraries, pure Tailwind CSS
+ 2. **Dark Mode**: All components use dark theme by default
+ 3. **Accessibility**: Keyboard navigation, ARIA labels, focus states
+ 4. **Responsive**: Components adapt to container sizes
+ 5. **Performance**: Lazy loading for images, optimized transitions
+ 
+ ## Next Steps
+ 
+ 1. Integrate with extension content script for real image detection
+ 2. Connect to storage layer for persistence
+ 3. Implement export functionality
+ 4. Add toast notification system
+ 5. Test on various screen sizes and browsers
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `specs/001-capthat-extension`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Creating a summary document:


---

<tool-use data-tool-type="unknown" data-tool-name="write">
<details>
<summary>Tool use: **write**</summary>


Parameters:

```json
{
  "relativeWorkspacePath": "specs/001-capthat-extension/PLANNING_SUMMARY.md"
}
```
Additional data:

```json
{
  "codeblockId": "f49c0523-224f-465e-9013-f307b8c10e14"
}
```
User decision: **accepted**

Status: **loading**


</details>
</tool-use>

---



---



---

